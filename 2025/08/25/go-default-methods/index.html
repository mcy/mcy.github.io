<!DOCTYPE html> <html lang="en-us"> <head> <link href="https://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Default Methods in Go &middot; mcyoung </title> <script async src="https://mcyoung.xyz/public/js/redirect.js"></script> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/syntax.css"> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/syntax-overrides.css"> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/styles.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css"> <link rel="preload" href="https://mcyoung.xyz/public/fonts/abril-fatface.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/rokkitt.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/rokkitt-italic.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/spline-mono.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/spline-mono-italic.woff2" as="font" type="font/woff2" crossorigin> <link rel="shortcut icon" href="https://mcyoung.xyz/public/favicon.ico"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <script src="https://mcyoung.xyz/public/js/minimap.js"></script> <script src="https://mcyoung.xyz/public/js/nsfw.js"></script> <script data-goatcounter="https://mcy.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:title" content="Default Methods in Go &middot; mcyoung"> <meta name="twitter:image" content="https://mcyoung.xyz/og/go-default-methods-8fbd63a272692e1048edfaebb01768f58f57222b.png"> <meta property="og:title" content="Default Methods in Go &middot; mcyoung"> <meta property="og:type" content="object"> <meta property="og:image" content="https://mcyoung.xyz/og/go-default-methods-8fbd63a272692e1048edfaebb01768f58f57222b.png"> <meta property="og:height" content="630"> <meta property="og:width" content="1200"> <meta property="og:url" content="https://mcyoung.xyz/2025/08/25/go-default-methods/"> </head> <body> <div class="sidebar"> <div class="sidebar-avatar hide-if-mobile"> <a href="https://mcyoung.xyz"> <img class="sidebar-avatar" src="https://mcyoung.xyz/public/images/avatar.png" alt="Yeah, I drew this. Check out my art blog."></a> </div> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1><a href="https://mcyoung.xyz"> mcyoung </a></h1> <div class="lead hide-if-mobile">I'm Miguel. I write about compilers, performance, and silly computer things. I also draw Pokémon. </div> </div> <hr class="hide-if-mobile"/> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="https://mcyoung.xyz">Home</a> • <a class="sidebar-nav-item " href="https://mcyoung.xyz/art">Art</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/resume">Resumé</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/syllabus">Syllabus</a> </nav> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="https://mcyoung.xyz/about">About</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/posts">Posts</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/tags">Tags</a> • <a class="sidebar-nav-item" href="https://github.com/mcy"> <img src="https://mcyoung.xyz/public/images/github.svg"></a> • <a class="sidebar-nav-item" href="https://bsky.app/profile/mcy.gay"> <img style="height: 0.75em;" src="https://mcyoung.xyz/public/images/bsky.svg"></a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/feed"> <img style="height: 0.8em; transform: translate(0.07em, 0.15em);" src="https://mcyoung.xyz/public/images/rss.svg"></a> </nav> <br class="hide-if-mobile"/> <span class="hide-if-mobile">&copy; 2025 Miguel Young de la Sota <br> <div style="font-size: 95%;"> <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC BY-SA</a> • <a href="https://varz.mcyoung.xyz/">Site Analytics</a> </div></span> </div> </div> <div class="content container"><div class="post-title"> <span class="post-meta"> 2025-08-25 • 2194 words • 24 minutes <br class="show-if-mobile"/> <span class="hide-if-mobile">•</span> <a href="https://mcyoung.xyz/tags.html#go">#go</a> • <a href="https://mcyoung.xyz/tags.html#language-design">#language-design</a> </span> <h1><a href="/2025/08/25/go-default-methods/"> Default Methods in Go </a></h1> </div> <div class="post"> <p>Go’s interfaces are very funny. Rather than being explicitly implemented, like in Java or Rust, they are simply a collection of methods (a “method set”) that the concrete type must <em>happen</em> to have. This is called structural typing, which is the opposite of nominal typing.</p> <p>Go interfaces are very cute, but this conceptual simplicity leads to a lot of implementation problems (a theme with Go, honestly). It removes a lot of intentionality from implementing interfaces, and there is no canonical way to document that <code class="language-plaintext highlighter-rouge">A</code> satisfies<sup id="fnref:satisfy-implement" role="doc-noteref"><a href="#fn:satisfy-implement" class="footnote" rel="footnote">1</a></sup> <code class="language-plaintext highlighter-rouge">B</code>, nor can you <em>avoid</em> conforming to interfaces, especially if one forces a particular method on you.</p> <p>It also has very quirky results for the language runtime. To cast an interface value to another interface type (via the type assertion syntax <code class="language-plaintext highlighter-rouge">a.(B)</code>), the runtime essentially has to use reflection to go through the method set of the concrete type of <code class="language-plaintext highlighter-rouge">a</code>. I go into detail on how this is implemented <a href="https://mcyoung.xyz/2024/12/12/go-abi#codegen-for-interface-operations">here</a>.</p> <p>Because of their structural nature, this <em>also</em> means that you can’t add new methods to an interface without breaking existing code, because there is no way to attach default implementations to interface methods. This results in very silly APIs because someone screwed up an interface.</p> <h2 id="flagvalue-is-a-mess"><a href="#flagvalue-is-a-mess">flag.Value is a Mess</a></h2> <p>For example, in the standard library’s package <code class="language-plaintext highlighter-rouge">flag</code>, the interface <code class="language-plaintext highlighter-rouge">flag.Value</code> represents a value which can be parsed as a CLI flag. It looks like this:</p> <div class="codeblock" id="code:1"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Value</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="c">// Get a string representation of the value.</span>
  <span class="n">String</span><span class="p">()</span> <span class="kt">string</span>

  <span class="c">// Parse a value from a string, possibly returning an error.</span>
  <span class="n">Set</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:1">Go</a></div></div> <p><code class="language-plaintext highlighter-rouge">flag.Value</code> also has an optional method, which is only specified in the documentation. If the concrete type happens to provide <code class="language-plaintext highlighter-rouge">IsBoolFlag() bool</code>, it will be queries for determining if the flag should have bool-like behavior. Essentially, this means that something like this exists in the flag library:</p> <div class="codeblock" id="code:2"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">var</span> <span class="n">isBool</span> <span class="kt">bool</span>
<span class="k">if</span> <span class="n">b</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">value</span><span class="o">.</span><span class="p">(</span><span class="k">interface</span><span class="p">{</span> <span class="n">IsBoolFlag</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">});</span> <span class="n">ok</span> <span class="p">{</span>
  <span class="n">isBool</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">IsBoolFlag</span><span class="p">()</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:2">Go</a></div></div> <p>The <code class="language-plaintext highlighter-rouge">flag</code> package already uses reflection, but you can see how it might be a problem if this interface-to-interface cast happens regularly, even taking into account Go’s caching of cast results.</p> <p>There is also <code class="language-plaintext highlighter-rouge">flag.Getter</code>, which exists because they messed up and didn’t provide a way for a <code class="language-plaintext highlighter-rouge">flag.Value</code> to unwrap into the value it contains. For example, if a flag is defined with <code class="language-plaintext highlighter-rouge">flag.Int</code>, and then that flag is looked up with <code class="language-plaintext highlighter-rouge">flag.Lookup</code>, there’s no straightforward way to get the int out of the returned <code class="language-plaintext highlighter-rouge">flag.Value</code>.</p> <p>Instead, you have to side-cast to <code class="language-plaintext highlighter-rouge">flag.Getter</code>:</p> <div class="codeblock" id="code:3"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Getter</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Value</span>

  <span class="c">// Returns the value of the flag.</span>
  <span class="n">Get</span><span class="p">()</span> <span class="n">any</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:3">Go</a></div></div> <p>As a result, <code class="language-plaintext highlighter-rouge">flag.Lookup("...").(flag.Getter)</code> needs to do a lot more work than if <code class="language-plaintext highlighter-rouge">flag.Value</code> had just added <code class="language-plaintext highlighter-rouge">Get() any</code>, with a default return value of <code class="language-plaintext highlighter-rouge">nil</code>.</p> <p>It turns out that there is a rather elegant workaround for this.</p> <h2 id="struct-embeddings"><a href="#struct-embeddings">Struct Embeddings</a></h2> <p>Go has this quirky feature called <em>embedding</em>, where a a field in a struct is declared without a name:</p> <div class="codeblock" id="code:4"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="p">(</span>
  <span class="n">A</span> <span class="kt">int</span>
  <span class="n">B</span> <span class="k">struct</span><span class="p">{</span>
    <span class="n">A</span>
    <span class="n">Foo</span> <span class="kt">int</span>
  <span class="p">}</span>
<span class="p">)</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:4">Go</a></div></div> <p>The <code class="language-plaintext highlighter-rouge">A</code>-typed embedded field behaves as if we had declared the field <code class="language-plaintext highlighter-rouge">A A</code>, but selectors on <code class="language-plaintext highlighter-rouge">var b B</code> will search in <code class="language-plaintext highlighter-rouge">A</code> if they do not match something on the <code class="language-plaintext highlighter-rouge">B</code> level. For example, if <code class="language-plaintext highlighter-rouge">A</code> has a method <code class="language-plaintext highlighter-rouge">Bar</code>, and <code class="language-plaintext highlighter-rouge">B</code> does not, <code class="language-plaintext highlighter-rouge">b.Bar()</code> will resolve to <code class="language-plaintext highlighter-rouge">b.A.Bar()</code>. However, if <code class="language-plaintext highlighter-rouge">A</code> has a method <code class="language-plaintext highlighter-rouge">Foo</code>, <code class="language-plaintext highlighter-rouge">b.Foo</code> resolves to <code class="language-plaintext highlighter-rouge">b.Foo</code>, not <code class="language-plaintext highlighter-rouge">b.A.Foo</code>, because <code class="language-plaintext highlighter-rouge">b</code> has a field <code class="language-plaintext highlighter-rouge">Foo</code>.</p> <p>Importantly, any methods from <code class="language-plaintext highlighter-rouge">A</code> which <code class="language-plaintext highlighter-rouge">B</code> does not already have will be added to <code class="language-plaintext highlighter-rouge">B</code>’s method set. So this works:</p> <div class="codeblock" id="code:5"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="p">(</span>
  <span class="n">A</span> <span class="kt">int</span>
  <span class="n">B</span> <span class="k">struct</span><span class="p">{</span> <span class="n">A</span> <span class="p">}</span>
  <span class="n">C</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">Foo</span><span class="p">()</span>
    <span class="n">Bar</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">)</span>

<span class="k">func</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="n">Foo</span><span class="p">()</span> <span class="p">{}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="n">Bar</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">var</span> <span class="n">_</span> <span class="n">C</span> <span class="o">=</span> <span class="n">B</span><span class="p">{}</span>  <span class="c">// B satisfies C.</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:5">Go</a></div></div> <p>Now, suppose that we were trying to add <code class="language-plaintext highlighter-rouge">Get() any</code> to <code class="language-plaintext highlighter-rouge">flag.Value</code>. Let’s suppose that we had also defined <code class="language-plaintext highlighter-rouge">flag.ValueDefaults</code>, a type that all satisfiers of <code class="language-plaintext highlighter-rouge">flag.Value</code> must embed. Then, we can write the following:</p> <div class="codeblock" id="code:6"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Value</span> <span class="k">interface</span><span class="p">{</span>
  <span class="n">String</span><span class="p">()</span> <span class="kt">string</span>
  <span class="n">Set</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

  <span class="n">Get</span><span class="p">()</span> <span class="n">any</span>  <span class="c">// New method.</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">ValueDefaults</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">ValueDefaults</span><span class="p">)</span> <span class="n">Get</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="no">nil</span> <span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:6">Go</a></div></div> <p>Then, no code change is required for all clients to pick up the new implementation of <code class="language-plaintext highlighter-rouge">Get()</code>.</p> <h3 id="required-embeds"><a href="#required-embeds">Required Embeds</a></h3> <p>Now, this only works if we had required in the first place that anyone satisfying <code class="language-plaintext highlighter-rouge">flag.Value</code> embeds <code class="language-plaintext highlighter-rouge">flag.ValueDefaults</code>. How can we force that?</p> <p>A little-known Go feature is that interfaces can have unexported methods. The way these work, for the purposes of interface conformance, is that exported methods are matched just by their name, but unexported methods must match both name and package.</p> <p>So, if we have an interface like <code class="language-plaintext highlighter-rouge">interface { foo() }</code>, then <code class="language-plaintext highlighter-rouge">foo</code> will only match methods defined in the same package that this interface expression appears. This is useful for preventing satisfaction of interfaces.</p> <p>However, there is a loophole: embedding inherits the <em>entire</em> method set, including unexported methods. Therefore, we can enhance <code class="language-plaintext highlighter-rouge">Value</code> to account for this:</p> <div class="codeblock" id="code:7"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Value</span> <span class="k">interface</span><span class="p">{</span>
  <span class="n">String</span><span class="p">()</span> <span class="kt">string</span>
  <span class="n">Set</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

  <span class="n">Get</span><span class="p">()</span> <span class="n">any</span>  <span class="c">// New method.</span>

  <span class="n">value</span><span class="p">()</span> <span class="c">// Unexported!</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">ValueDefaults</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">ValueDefaults</span><span class="p">)</span> <span class="n">Get</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="no">nil</span> <span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">ValueDefaults</span><span class="p">)</span> <span class="n">value</span><span class="p">()</span> <span class="p">{}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:7">Go</a></div></div> <p>Now, it’s impossible for any type defined outside of this package to satisfy <code class="language-plaintext highlighter-rouge">flag.Value</code>, without embedding <code class="language-plaintext highlighter-rouge">flag.ValueDefaults</code> (either directly or through another embedded <code class="language-plaintext highlighter-rouge">flag.Value</code>).</p> <h3 id="exported-struct-fields"><a href="#exported-struct-fields">Exported Struct Fields</a></h3> <p>Now, another problem is that you can’t control the name of embedded fields. If the embedded type is <code class="language-plaintext highlighter-rouge">Foo</code>, the field’s name is <code class="language-plaintext highlighter-rouge">Foo</code>. Except, it’s not based on the name of the type itself; it will pick up the name of a type alias. So, if you want to unexport the defaults struct, you can simply write:</p> <div class="codeblock" id="code:8"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">MyValue</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">valueDefaults</span>

  <span class="c">// ...</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">valueDefaults</span> <span class="o">=</span> <span class="n">flag</span><span class="o">.</span><span class="n">ValueDefaults</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:8">Go</a></div></div> <p>This also has the side-effect of hiding all of <code class="language-plaintext highlighter-rouge">ValueDefaults</code>’ methods from <code class="language-plaintext highlighter-rouge">MyValue</code>’s documentation, despite the fact that exported and fields methods are still selectable and callable by other packages (including via interfaces). As far as I can tell, this is simply a bug in <code class="language-plaintext highlighter-rouge">godoc</code>, since this behavior is not documented.</p> <h3 id="what-about-same-name-methods"><a href="#what-about-same-name-methods">What About Same-Name Methods?</a></h3> <p>There is still a failure mode: if a user type satisfying <code class="language-plaintext highlighter-rouge">flag.Value</code> happened to define a <code class="language-plaintext highlighter-rouge">Get</code> method with a different interface. In this case, that <code class="language-plaintext highlighter-rouge">Get</code> takes precedence, and changes to <code class="language-plaintext highlighter-rouge">flag.Value</code> will break users.</p> <p>There are two workarounds:</p> <ol> <li> <p>Tell people not to define methods on their satisfying type, and if they do, they’re screwed. Because satisfying <code class="language-plaintext highlighter-rouge">flag.Value</code> is now explicit, this is not too difficult to ask for.</p> </li> <li> <p>Pick a name for new methods that is unlikely to collide with anything.</p> </li> </ol> <p>Unfortunately, this runs into a big issue with structural typing, which is that it is very difficult to avoid making mistakes when making changes, due to the lack of intent involved. A similar problem occurs with C++ templates, where the interfaces defined by concepts are implicit, and can result in violating contract expectations.</p> <p>Go has historically be relatively cavalier about this kind of issue, so I think that breaking people based on this is fine.</p> <p>And of course, you cannot retrofit a default struct into a interface; you have to define it from day one.</p> <h2 id="using-defaults"><a href="#using-defaults">Using Defaults</a></h2> <p>Now that we have defaults, we can also enhance <code class="language-plaintext highlighter-rouge">flag.Value</code> with bool flag detection:</p> <div class="codeblock" id="code:9"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Value</span> <span class="k">interface</span><span class="p">{</span>
  <span class="n">String</span><span class="p">()</span> <span class="kt">string</span>
  <span class="n">Set</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

  <span class="n">Get</span><span class="p">()</span> <span class="n">any</span>
  <span class="n">IsBoolFlag</span><span class="p">()</span> <span class="kt">bool</span>

  <span class="n">value</span><span class="p">()</span> <span class="c">// Unexported!</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">ValueDefaults</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">ValueDefaults</span><span class="p">)</span> <span class="n">Get</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="no">nil</span> <span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">ValueDefaults</span><span class="p">)</span> <span class="n">IsBoolFlag</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="no">false</span> <span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">ValueDefaults</span><span class="p">)</span> <span class="n">value</span><span class="p">()</span> <span class="p">{}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:9">Go</a></div></div> <p>Now <code class="language-plaintext highlighter-rouge">IsBoolFlag</code> is more than just a random throw-away comment on a type.</p> <p>We can also use defaults to speed up side casts. Many functions around the <code class="language-plaintext highlighter-rouge">io</code> package will cast an <code class="language-plaintext highlighter-rouge">io.Reader</code> into an <code class="language-plaintext highlighter-rouge">io.Seeker</code> or <code class="language-plaintext highlighter-rouge">io.ReadAt</code> to perform more efficient I/O.</p> <p>In a hypothetical world where we had defaults structs for all the <code class="language-plaintext highlighter-rouge">io</code> interfaces, we can enhance <code class="language-plaintext highlighter-rouge">io.Reader</code> with a <code class="language-plaintext highlighter-rouge">ReadAt</code> default method that by default returns an error.</p> <div class="codeblock" id="code:10"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Reader</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Read</span><span class="p">([]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
  <span class="n">ReadAt</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

  <span class="n">reader</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">ReaderDefaults</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">ReaderDefaults</span><span class="p">)</span> <span class="n">ReadAt</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="m">0</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">ErrUnsupported</span>
<span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">ReaderDefaults</span><span class="p">)</span> <span class="n">reader</span><span class="p">()</span> <span class="p">{}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:10">Go</a></div></div> <p>We can do something similar for <code class="language-plaintext highlighter-rouge">io.Seeker</code>, but because it’s a rather general interface, it’s better to keep <code class="language-plaintext highlighter-rouge">io.Seeker</code> as-is. So, we can add a conversion method:</p> <div class="codeblock" id="code:11"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Reader</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Seeker</span><span class="p">()</span> <span class="n">io</span><span class="o">.</span><span class="n">Seeker</span>

  <span class="c">// ...</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">ReaderDefaults</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">ReaderDefaults</span><span class="p">)</span> <span class="n">Seeker</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">int64</span><span class="p">)</span> <span class="n">io</span><span class="o">.</span><span class="n">Seeker</span> <span class="p">{</span>
  <span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:11">Go</a></div></div> <p>Here, <code class="language-plaintext highlighter-rouge">Reader.Seeker()</code> converts to an <code class="language-plaintext highlighter-rouge">io.Seeker</code>, returning <code class="language-plaintext highlighter-rouge">nil</code> if that’s not possible. How is this faster than <code class="language-plaintext highlighter-rouge">r.(io.Seeker)</code>? Well, consider what this would look like in user code:</p> <div class="codeblock" id="code:12"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">MyIO</span> <span class="k">struct</span><span class="p">{</span>
  <span class="n">io</span><span class="o">.</span><span class="n">ReaderDefaults</span>
  <span class="c">// ...</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">MyIO</span><span class="p">)</span> <span class="n">Read</span><span class="p">(</span><span class="n">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">MyIO</span><span class="p">)</span> <span class="n">Seek</span><span class="p">(</span><span class="n">offset</span> <span class="kt">int64</span><span class="p">,</span> <span class="n">whence</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="kt">int64</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span> <span class="c">/* ... */</span> <span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">MyIO</span><span class="p">)</span> <span class="n">Seeker</span><span class="p">()</span> <span class="n">io</span><span class="o">.</span><span class="n">Seeker</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">m</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:12">Go</a></div></div> <p>Calling <code class="language-plaintext highlighter-rouge">r.Seeker()</code>, if <code class="language-plaintext highlighter-rouge">r</code> is an <code class="language-plaintext highlighter-rouge">io.Reader</code> containing a <code class="language-plaintext highlighter-rouge">MyIO</code>, lowers to the following machine code:</p> <ol> <li>Load the function pointer for <code class="language-plaintext highlighter-rouge">Seeker</code> out of <code class="language-plaintext highlighter-rouge">r</code>’s itab.</li> <li>Perform an indirect jump on that function pointer.</li> <li>Inside of <code class="language-plaintext highlighter-rouge">(*MyIO).Seeker</code>, load a pointer to the itab symbol <code class="language-plaintext highlighter-rouge">go:itab.*MyIO,io.Seeker</code> and <code class="language-plaintext highlighter-rouge">m</code> into the return slots.</li> <li>Return.</li> </ol> <p>The main cost of this conversion is the indirect jump, compared to, at minimum, hitting a hashmap lookup loop for the cache for <code class="language-plaintext highlighter-rouge">r.(io.Seeker)</code>.</p> <p>Does this performance matter? Not for I/O interfaces, probably, but it <em>can</em> matter for some uses!</p> <h2 id="shouldnt-this-be-a-language-feature"><a href="#shouldnt-this-be-a-language-feature">Shouldn’t This Be a Language Feature?</a></h2> <p>Yes, it should, but here we are. Although making it a language feature has a few rather unfortunate quirks that we need to keep in mind.</p> <p>Suppose we can define defaults on interface methods somehow, like this:</p> <div class="codeblock" id="code:13"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Foo</span> <span class="k">interface</span><span class="p">{</span>
  <span class="n">Bar</span><span class="p">()</span>
  <span class="n">Baz</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">f</span> <span class="n">Foo</span><span class="p">)</span> <span class="n">Baz</span><span class="p">()</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:13">Go</a></div></div> <p>Then, any type which provides <code class="language-plaintext highlighter-rouge">Bar()</code> automatically satisfies <code class="language-plaintext highlighter-rouge">Foo</code>. Suppose <code class="language-plaintext highlighter-rouge">MyFoo</code> satisfies <code class="language-plaintext highlighter-rouge">Foo</code>, but does not provide <code class="language-plaintext highlighter-rouge">Baz</code>. Then we have a problem:</p> <div class="codeblock" id="code:14"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">var</span> <span class="n">x</span> <span class="n">MyFoo</span>
<span class="n">x</span><span class="o">.</span><span class="n">Baz</span><span class="p">()</span>       <span class="c">// Error!</span>
<span class="n">Foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">Baz</span><span class="p">()</span>  <span class="c">// Ok!</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:14">Go</a></div></div> <p>Now, we might consider looking past that, but it becomes a big problem with reflection. If we passed <code class="language-plaintext highlighter-rouge">Foo(x)</code> into <code class="language-plaintext highlighter-rouge">reflect.ValueOf</code>, the resulting <code class="language-plaintext highlighter-rouge">any</code> conversion would discard the defaulted method, meaning that it would not be findable by <code class="language-plaintext highlighter-rouge">reflect.Value.MethodByName()</code>. Oops.</p> <p>So we need to somehow add <code class="language-plaintext highlighter-rouge">Baz</code> to <code class="language-plaintext highlighter-rouge">MyFoo</code>’s method set. Maybe we say that if <code class="language-plaintext highlighter-rouge">MyFoo</code> is ever converted into <code class="language-plaintext highlighter-rouge">Foo</code>, it gets the method. But this doesn’t work, because the compiler might not be able to see through something like <code class="language-plaintext highlighter-rouge">any(MyFoo{...}).(Foo)</code>. This means that <code class="language-plaintext highlighter-rouge">Baz</code> must be applied unconditionally. But, now we have the problem that if we have another interface <code class="language-plaintext highlighter-rouge">interface { Bar(); Baz(int) }</code>, <code class="language-plaintext highlighter-rouge">MyFoo</code> would need to receive incompatible signatures for <code class="language-plaintext highlighter-rouge">Baz</code>.</p> <p>Again, we’re screwed by the non-intentionality of structural typing.</p> <h3 id="missing-methods"><a href="#missing-methods">Missing Methods</a></h3> <p>Ok, let’s forget about default method implementations, that doesn’t seem to be workable. What if we make some methods optional, like <code class="language-plaintext highlighter-rouge">IsBoolFlag()</code> earlier? Let’s invent some syntax for it.</p> <div class="codeblock" id="code:15"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Foo</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Bar</span><span class="p">()</span>
  <span class="err">?</span><span class="n">Baz</span><span class="p">()</span> <span class="c">// Optional method.</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:15">Go</a></div></div> <p>Then, suppose that <code class="language-plaintext highlighter-rouge">MyFoo</code> provides <code class="language-plaintext highlighter-rouge">Bar</code> but not <code class="language-plaintext highlighter-rouge">Baz</code> (or <code class="language-plaintext highlighter-rouge">Baz</code> with the wrong signature). Then, the entry in the itab for <code class="language-plaintext highlighter-rouge">Baz</code> would contain a nil function pointer, such that <code class="language-plaintext highlighter-rouge">x.Baz()</code> panics! To determine if <code class="language-plaintext highlighter-rouge">Baz</code> is safe to call, we would use the following idiom:</p> <div class="codeblock" id="code:16"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">Baz</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
  <span class="n">x</span><span class="o">.</span><span class="n">Baz</span><span class="p">()</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:16">Go</a></div></div> <p>The compiler is already smart enough to elide construction of funcvals for cases like this, although it does mean that <code class="language-plaintext highlighter-rouge">x.Func</code> in general, for an interface value <code class="language-plaintext highlighter-rouge">x</code>, requires an extra <code class="language-plaintext highlighter-rouge">cmov</code> or similar to make sure that <code class="language-plaintext highlighter-rouge">x.Func</code> is nil when it’s a missing method.</p> <p>All of the use cases described above would work Just Fine using this construction, though! However, we run into the same issue that <code class="language-plaintext highlighter-rouge">Foo(x)</code> appears to have a larger method set than <code class="language-plaintext highlighter-rouge">x</code>. It is not clear if <code class="language-plaintext highlighter-rouge">Foo(x)</code> should conform to <code class="language-plaintext highlighter-rouge">interface { Bar(); Baz() }</code>, where <code class="language-plaintext highlighter-rouge">Baz</code> is required. My intuition would be no: <code class="language-plaintext highlighter-rouge">Foo</code> is a strictly weaker interface. Perhaps it might be necessary to avoid the method access syntax for optional methods, but that’s a question of aesthetics.</p> <p>This idea of having nulls in place of function pointers in a vtable is not new, but to my knowledge is not used especially widely. It would be very useful in C++, for example, to be able to determine if no implementation was provided for a non-pure virtual function. However, the nominal nature of C++’s virtual functions does not make this <em>as big</em> of a need.</p> <h3 id="related-interfaces"><a href="#related-interfaces">Related Interfaces</a></h3> <p>Another alternative is to store a related interfaces’ itabs on in an itab. For example, suppose that we invent the syntax <code class="language-plaintext highlighter-rouge">A&lt;-</code> within an <code class="language-plaintext highlighter-rouge">interface{}</code> to indicate that that interface will likely get cast to <code class="language-plaintext highlighter-rouge">A</code>. For example:</p> <div class="codeblock" id="code:17"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="p">(</span>
  <span class="n">A</span> <span class="k">interface</span><span class="p">{</span>
    <span class="n">Foo</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="n">B</span> <span class="k">interface</span><span class="p">{</span>
    <span class="n">Bar</span><span class="p">()</span>

    <span class="n">A</span><span class="o">&lt;-</span>
  <span class="p">}</span>
<span class="p">)</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:17">Go</a></div></div> <p>Satisfying <code class="language-plaintext highlighter-rouge">B</code> does not require satisfying <code class="language-plaintext highlighter-rouge">A</code>. However, the <code class="language-plaintext highlighter-rouge">A&lt;-</code> must be part of public API, because a <code class="language-plaintext highlighter-rouge">interface{ Bar() }</code> cannot be used in place of an <code class="language-plaintext highlighter-rouge">interface{ A&lt;- }</code></p> <p>Within <code class="language-plaintext highlighter-rouge">B</code>’s itab, after all of the methods, there is a pointer to an itab for <code class="language-plaintext highlighter-rouge">A</code>, if the concrete type for this itab also happens to satisfy <code class="language-plaintext highlighter-rouge">A</code>. Then, a cast from <code class="language-plaintext highlighter-rouge">B</code> to <code class="language-plaintext highlighter-rouge">A</code> is just loading a pointer from the itab. If the cast would fail, the loaded pointer will be <code class="language-plaintext highlighter-rouge">nil</code>.</p> <p>I had always assumed that Go did an optimization like this for embedding interfaces, but no! <em>Any</em> inter-interface conversion, including upcasts, goes through the whole type assertion machinery! Of course, Go cannot hope to generate an itab for every possible subset of the method set of an interface (exponential blow-up), but it’s surprising that they don’t do this for embedded interfaces, which are Go’s equivalent of superinterfaces (present in basically every language with interfaces).</p> <p>Using this feature, we can update <code class="language-plaintext highlighter-rouge">flag.Value</code> to look like this:</p> <div class="codeblock" id="code:18"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">Value</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">String</span><span class="p">()</span> <span class="kt">string</span>
  <span class="n">Set</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

  <span class="n">BoolValue</span><span class="o">&lt;-</span>
  <span class="n">Getter</span><span class="o">&lt;-</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">BoolValue</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Value</span>
  <span class="n">IsBoolFlag</span><span class="p">()</span> <span class="kt">bool</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Getter</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Value</span>
  <span class="n">Get</span><span class="p">()</span> <span class="n">any</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:18">Go</a></div></div> <p>Unfortunately, because <code class="language-plaintext highlighter-rouge">A&lt;-</code> changes the ABI of an interface, it does not seem possible to actually add this to existing interfaces, because the following code is valid:</p> <div class="codeblock" id="code:19"><figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k">type</span> <span class="n">A</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Foo</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">var</span> <span class="p">(</span>
  <span class="n">a</span> <span class="n">A</span>
  <span class="n">b</span> <span class="k">interface</span><span class="p">{</span> <span class="n">Foo</span><span class="p">()</span> <span class="p">}</span>
<span class="p">)</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:19">Go</a></div></div> <p>Even though this fix seems really clean, it doesn’t work! The only way it could work is if PGO determines that a particular interface conversion <code class="language-plaintext highlighter-rouge">A</code> to <code class="language-plaintext highlighter-rouge">B</code> happens a lot, and updates the ABI of all interfaces with the method set of <code class="language-plaintext highlighter-rouge">A</code>, program-globally, to contain a pointer to a <code class="language-plaintext highlighter-rouge">B</code> itab if available.</p> <h2 id="conclusion"><a href="#conclusion">Conclusion</a></h2> <p>Go’s interfaces are pretty bad; in my opinion, a feature that looks good on a slide, but which results in a lot of mess due to its granular and intention-less nature. We can sort of patch over it with embeds, but there’s still problems.</p> <p>Due to how method sets work in Go, it’s very hard to “add” methods through an interface, and honestly at this point, any interface mechanism that makes it impossible (or expensive) to add new functions is going to be a huge problem.</p> <p>Missing methods seems like the best way out of this problem, but for now, we can stick to the janky embedded structs.</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:satisfy-implement" role="doc-endnote"> <p>Go uses the term “implements” to say that a type satisfies an interface. I am instead intentionally using the term “satisfies”, because it makes the structural, passive nature of implementing an interface clearer. This is also more in-line with interfaces’ use as generic constraints.</p> <p>Swift uses the term “conform” instead, which I am avoiding for this reason. <a href="#fnref:satisfy-implement" class="reversefootnote" role="doc-backlink">&#8617;</a></p> </li> </ol> </div> </div> <div class="related post-footer"> <h2>Related Posts</h2> <ul class="related-posts"> <li> <span class="post-meta">2025-10-30</span> / <h6 style="display:inline"><a href="/2025/10/30/living-room-2/">Living Room 2</a></h6> <li> <span class="post-meta">2025-10-28</span> / <h6 style="display:inline"><a href="/2025/10/28/boombox-boobs/">Boombox Boobs</a></h6> <li> <span class="post-meta">2025-10-27</span> / <h6 style="display:inline"><a href="/2025/10/27/living-room/">Living Room</a></h6> </ul> </div> <div class="minimap" aria-hidden="true"> <div class="minimap-size"></div> <div class="minimap-controller"></div> <div class="minimap-content"> <div class="content container"> <div class="post-title"> <span class="post-meta"> <span class="censored">2025-08-25</span> <span class="censored">•</span> <span class="censored">2194</span> <span class="censored">words</span> <span class="censored">•</span> <span class="censored">24</span> <span class="censored">minutes</span> <br class="show-if-mobile"> <span class="hide-if-mobile"><span class="censored">•</span></span> <a href="https://mcyoung.xyz/tags.html#go"><span class="censored">#go</span></a> <span class="censored">•</span> <a href="https://mcyoung.xyz/tags.html#language-design"><span class="censored">#language-design</span></a> </span> <h1><a href="/2025/08/25/go-default-methods/"> <span class="censored">Default</span> <span class="censored">Methods</span> <span class="censored">in</span> <span class="censored">Go</span> </a></h1> </div> <div class="post"> <p><span class="censored">Go’s</span> <span class="censored">interfaces</span> <span class="censored">are</span> <span class="censored">very</span> <span class="censored">funny.</span> <span class="censored">Rather</span> <span class="censored">than</span> <span class="censored">being</span> <span class="censored">explicitly</span> <span class="censored">implemented,</span> <span class="censored">like</span> <span class="censored">in</span> <span class="censored">Java</span> <span class="censored">or</span> <span class="censored">Rust,</span> <span class="censored">they</span> <span class="censored">are</span> <span class="censored">simply</span> <span class="censored">a</span> <span class="censored">collection</span> <span class="censored">of</span> <span class="censored">methods</span> <span class="censored">(a</span> <span class="censored">“method</span> <span class="censored">set”)</span> <span class="censored">that</span> <span class="censored">the</span> <span class="censored">concrete</span> <span class="censored">type</span> <span class="censored">must</span> <em><span class="censored">happen</span></em> <span class="censored">to</span> <span class="censored">have.</span> <span class="censored">This</span> <span class="censored">is</span> <span class="censored">called</span> <span class="censored">structural</span> <span class="censored">typing,</span> <span class="censored">which</span> <span class="censored">is</span> <span class="censored">the</span> <span class="censored">opposite</span> <span class="censored">of</span> <span class="censored">nominal</span> <span class="censored">typing.</span></p> <p><span class="censored">Go</span> <span class="censored">interfaces</span> <span class="censored">are</span> <span class="censored">very</span> <span class="censored">cute,</span> <span class="censored">but</span> <span class="censored">this</span> <span class="censored">conceptual</span> <span class="censored">simplicity</span> <span class="censored">leads</span> <span class="censored">to</span> <span class="censored">a</span> <span class="censored">lot</span> <span class="censored">of</span> <span class="censored">implementation</span> <span class="censored">problems</span> <span class="censored">(a</span> <span class="censored">theme</span> <span class="censored">with</span> <span class="censored">Go,</span> <span class="censored">honestly).</span> <span class="censored">It</span> <span class="censored">removes</span> <span class="censored">a</span> <span class="censored">lot</span> <span class="censored">of</span> <span class="censored">intentionality</span> <span class="censored">from</span> <span class="censored">implementing</span> <span class="censored">interfaces,</span> <span class="censored">and</span> <span class="censored">there</span> <span class="censored">is</span> <span class="censored">no</span> <span class="censored">canonical</span> <span class="censored">way</span> <span class="censored">to</span> <span class="censored">document</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code> <span class="censored">satisfies</span><sup id="fnref:satisfy-implement" role="doc-noteref"><a href="#fn:satisfy-implement" class="footnote" rel="footnote"><span class="censored">1</span></a></sup> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code><span class="censored">,</span> <span class="censored">nor</span> <span class="censored">can</span> <span class="censored">you</span> <em><span class="censored">avoid</span></em> <span class="censored">conforming</span> <span class="censored">to</span> <span class="censored">interfaces,</span> <span class="censored">especially</span> <span class="censored">if</span> <span class="censored">one</span> <span class="censored">forces</span> <span class="censored">a</span> <span class="censored">particular</span> <span class="censored">method</span> <span class="censored">on</span> <span class="censored">you.</span></p> <p><span class="censored">It</span> <span class="censored">also</span> <span class="censored">has</span> <span class="censored">very</span> <span class="censored">quirky</span> <span class="censored">results</span> <span class="censored">for</span> <span class="censored">the</span> <span class="censored">language</span> <span class="censored">runtime.</span> <span class="censored">To</span> <span class="censored">cast</span> <span class="censored">an</span> <span class="censored">interface</span> <span class="censored">value</span> <span class="censored">to</span> <span class="censored">another</span> <span class="censored">interface</span> <span class="censored">type</span> <span class="censored">(via</span> <span class="censored">the</span> <span class="censored">type</span> <span class="censored">assertion</span> <span class="censored">syntax</span> <code class="language-plaintext highlighter-rouge"><span class="censored">a.(B)</span></code><span class="censored">),</span> <span class="censored">the</span> <span class="censored">runtime</span> <span class="censored">essentially</span> <span class="censored">has</span> <span class="censored">to</span> <span class="censored">use</span> <span class="censored">reflection</span> <span class="censored">to</span> <span class="censored">go</span> <span class="censored">through</span> <span class="censored">the</span> <span class="censored">method</span> <span class="censored">set</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">concrete</span> <span class="censored">type</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">a</span></code><span class="censored">.</span> <span class="censored">I</span> <span class="censored">go</span> <span class="censored">into</span> <span class="censored">detail</span> <span class="censored">on</span> <span class="censored">how</span> <span class="censored">this</span> <span class="censored">is</span> <span class="censored">implemented</span> <a href="https://mcyoung.xyz/2024/12/12/go-abi#codegen-for-interface-operations"><span class="censored">here</span></a><span class="censored">.</span></p> <p><span class="censored">Because</span> <span class="censored">of</span> <span class="censored">their</span> <span class="censored">structural</span> <span class="censored">nature,</span> <span class="censored">this</span> <em><span class="censored">also</span></em> <span class="censored">means</span> <span class="censored">that</span> <span class="censored">you</span> <span class="censored">can’t</span> <span class="censored">add</span> <span class="censored">new</span> <span class="censored">methods</span> <span class="censored">to</span> <span class="censored">an</span> <span class="censored">interface</span> <span class="censored">without</span> <span class="censored">breaking</span> <span class="censored">existing</span> <span class="censored">code,</span> <span class="censored">because</span> <span class="censored">there</span> <span class="censored">is</span> <span class="censored">no</span> <span class="censored">way</span> <span class="censored">to</span> <span class="censored">attach</span> <span class="censored">default</span> <span class="censored">implementations</span> <span class="censored">to</span> <span class="censored">interface</span> <span class="censored">methods.</span> <span class="censored">This</span> <span class="censored">results</span> <span class="censored">in</span> <span class="censored">very</span> <span class="censored">silly</span> <span class="censored">APIs</span> <span class="censored">because</span> <span class="censored">someone</span> <span class="censored">screwed</span> <span class="censored">up</span> <span class="censored">an</span> <span class="censored">interface.</span></p> <h2 id="flagvalue-is-a-mess"><a href="#flagvalue-is-a-mess"><span class="censored">flag.Value</span> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">Mess</span></a></h2> <p><span class="censored">For</span> <span class="censored">example,</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">standard</span> <span class="censored">library’s</span> <span class="censored">package</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag</span></code><span class="censored">,</span> <span class="censored">the</span> <span class="censored">interface</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">represents</span> <span class="censored">a</span> <span class="censored">value</span> <span class="censored">which</span> <span class="censored">can</span> <span class="censored">be</span> <span class="censored">parsed</span> <span class="censored">as</span> <span class="censored">a</span> <span class="censored">CLI</span> <span class="censored">flag.</span> <span class="censored">It</span> <span class="censored">looks</span> <span class="censored">like</span> <span class="censored">this:</span></p> <div class="codeblock" id="code:1"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Value</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="c"><span class="censored">//</span> <span class="censored">Get</span> <span class="censored">a</span> <span class="censored">string</span> <span class="censored">representation</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">value.</span></span>
  <span class="n"><span class="censored">String</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">string</span></span>

  <span class="c"><span class="censored">//</span> <span class="censored">Parse</span> <span class="censored">a</span> <span class="censored">value</span> <span class="censored">from</span> <span class="censored">a</span> <span class="censored">string,</span> <span class="censored">possibly</span> <span class="censored">returning</span> <span class="censored">an</span> <span class="censored">error.</span></span>
  <span class="n"><span class="censored">Set</span></span><span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">string</span></span><span class="p"><span class="censored">)</span></span> <span class="kt"><span class="censored">error</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:1"><span class="censored">Go</span></a></div> </div> <p><code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">also</span> <span class="censored">has</span> <span class="censored">an</span> <span class="censored">optional</span> <span class="censored">method,</span> <span class="censored">which</span> <span class="censored">is</span> <span class="censored">only</span> <span class="censored">specified</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">documentation.</span> <span class="censored">If</span> <span class="censored">the</span> <span class="censored">concrete</span> <span class="censored">type</span> <span class="censored">happens</span> <span class="censored">to</span> <span class="censored">provide</span> <code class="language-plaintext highlighter-rouge"><span class="censored">IsBoolFlag()</span> <span class="censored">bool</span></code><span class="censored">,</span> <span class="censored">it</span> <span class="censored">will</span> <span class="censored">be</span> <span class="censored">queries</span> <span class="censored">for</span> <span class="censored">determining</span> <span class="censored">if</span> <span class="censored">the</span> <span class="censored">flag</span> <span class="censored">should</span> <span class="censored">have</span> <span class="censored">bool-like</span> <span class="censored">behavior.</span> <span class="censored">Essentially,</span> <span class="censored">this</span> <span class="censored">means</span> <span class="censored">that</span> <span class="censored">something</span> <span class="censored">like</span> <span class="censored">this</span> <span class="censored">exists</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">flag</span> <span class="censored">library:</span></p> <div class="codeblock" id="code:2"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">var</span></span> <span class="n"><span class="censored">isBool</span></span> <span class="kt"><span class="censored">bool</span></span>
<span class="k"><span class="censored">if</span></span> <span class="n"><span class="censored">b</span></span><span class="p"><span class="censored">,</span></span> <span class="n"><span class="censored">ok</span></span> <span class="o"><span class="censored">:=</span></span> <span class="n"><span class="censored">value</span></span><span class="o"><span class="censored">.</span></span><span class="p"><span class="censored">(</span></span><span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span> <span class="n"><span class="censored">IsBoolFlag</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">bool</span></span> <span class="p"><span class="censored">});</span></span> <span class="n"><span class="censored">ok</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">isBool</span></span> <span class="o"><span class="censored">=</span></span> <span class="n"><span class="censored">b</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">IsBoolFlag</span></span><span class="p"><span class="censored">()</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:2"><span class="censored">Go</span></a></div> </div> <p><span class="censored">The</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag</span></code> <span class="censored">package</span> <span class="censored">already</span> <span class="censored">uses</span> <span class="censored">reflection,</span> <span class="censored">but</span> <span class="censored">you</span> <span class="censored">can</span> <span class="censored">see</span> <span class="censored">how</span> <span class="censored">it</span> <span class="censored">might</span> <span class="censored">be</span> <span class="censored">a</span> <span class="censored">problem</span> <span class="censored">if</span> <span class="censored">this</span> <span class="censored">interface-to-interface</span> <span class="censored">cast</span> <span class="censored">happens</span> <span class="censored">regularly,</span> <span class="censored">even</span> <span class="censored">taking</span> <span class="censored">into</span> <span class="censored">account</span> <span class="censored">Go’s</span> <span class="censored">caching</span> <span class="censored">of</span> <span class="censored">cast</span> <span class="censored">results.</span></p> <p><span class="censored">There</span> <span class="censored">is</span> <span class="censored">also</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Getter</span></code><span class="censored">,</span> <span class="censored">which</span> <span class="censored">exists</span> <span class="censored">because</span> <span class="censored">they</span> <span class="censored">messed</span> <span class="censored">up</span> <span class="censored">and</span> <span class="censored">didn’t</span> <span class="censored">provide</span> <span class="censored">a</span> <span class="censored">way</span> <span class="censored">for</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">to</span> <span class="censored">unwrap</span> <span class="censored">into</span> <span class="censored">the</span> <span class="censored">value</span> <span class="censored">it</span> <span class="censored">contains.</span> <span class="censored">For</span> <span class="censored">example,</span> <span class="censored">if</span> <span class="censored">a</span> <span class="censored">flag</span> <span class="censored">is</span> <span class="censored">defined</span> <span class="censored">with</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Int</span></code><span class="censored">,</span> <span class="censored">and</span> <span class="censored">then</span> <span class="censored">that</span> <span class="censored">flag</span> <span class="censored">is</span> <span class="censored">looked</span> <span class="censored">up</span> <span class="censored">with</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Lookup</span></code><span class="censored">,</span> <span class="censored">there’s</span> <span class="censored">no</span> <span class="censored">straightforward</span> <span class="censored">way</span> <span class="censored">to</span> <span class="censored">get</span> <span class="censored">the</span> <span class="censored">int</span> <span class="censored">out</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">returned</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code><span class="censored">.</span></p> <p><span class="censored">Instead,</span> <span class="censored">you</span> <span class="censored">have</span> <span class="censored">to</span> <span class="censored">side-cast</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Getter</span></code><span class="censored">:</span></p> <div class="codeblock" id="code:3"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Getter</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Value</span></span>

  <span class="c"><span class="censored">//</span> <span class="censored">Returns</span> <span class="censored">the</span> <span class="censored">value</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">flag.</span></span>
  <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="n"><span class="censored">any</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:3"><span class="censored">Go</span></a></div> </div> <p><span class="censored">As</span> <span class="censored">a</span> <span class="censored">result,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Lookup("...").(flag.Getter)</span></code> <span class="censored">needs</span> <span class="censored">to</span> <span class="censored">do</span> <span class="censored">a</span> <span class="censored">lot</span> <span class="censored">more</span> <span class="censored">work</span> <span class="censored">than</span> <span class="censored">if</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">had</span> <span class="censored">just</span> <span class="censored">added</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Get()</span> <span class="censored">any</span></code><span class="censored">,</span> <span class="censored">with</span> <span class="censored">a</span> <span class="censored">default</span> <span class="censored">return</span> <span class="censored">value</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">nil</span></code><span class="censored">.</span></p> <p><span class="censored">It</span> <span class="censored">turns</span> <span class="censored">out</span> <span class="censored">that</span> <span class="censored">there</span> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">rather</span> <span class="censored">elegant</span> <span class="censored">workaround</span> <span class="censored">for</span> <span class="censored">this.</span></p> <h2 id="struct-embeddings"><a href="#struct-embeddings"><span class="censored">Struct</span> <span class="censored">Embeddings</span></a></h2> <p><span class="censored">Go</span> <span class="censored">has</span> <span class="censored">this</span> <span class="censored">quirky</span> <span class="censored">feature</span> <span class="censored">called</span> <em><span class="censored">embedding</span></em><span class="censored">,</span> <span class="censored">where</span> <span class="censored">a</span> <span class="censored">a</span> <span class="censored">field</span> <span class="censored">in</span> <span class="censored">a</span> <span class="censored">struct</span> <span class="censored">is</span> <span class="censored">declared</span> <span class="censored">without</span> <span class="censored">a</span> <span class="censored">name:</span></p> <div class="codeblock" id="code:4"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="p"><span class="censored">(</span></span>
  <span class="n"><span class="censored">A</span></span> <span class="kt"><span class="censored">int</span></span>
  <span class="n"><span class="censored">B</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{</span></span>
    <span class="n"><span class="censored">A</span></span>
    <span class="n"><span class="censored">Foo</span></span> <span class="kt"><span class="censored">int</span></span>
  <span class="p"><span class="censored">}</span></span>
<span class="p"><span class="censored">)</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:4"><span class="censored">Go</span></a></div> </div> <p><span class="censored">The</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code><span class="censored">-typed</span> <span class="censored">embedded</span> <span class="censored">field</span> <span class="censored">behaves</span> <span class="censored">as</span> <span class="censored">if</span> <span class="censored">we</span> <span class="censored">had</span> <span class="censored">declared</span> <span class="censored">the</span> <span class="censored">field</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span> <span class="censored">A</span></code><span class="censored">,</span> <span class="censored">but</span> <span class="censored">selectors</span> <span class="censored">on</span> <code class="language-plaintext highlighter-rouge"><span class="censored">var</span> <span class="censored">b</span> <span class="censored">B</span></code> <span class="censored">will</span> <span class="censored">search</span> <span class="censored">in</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code> <span class="censored">if</span> <span class="censored">they</span> <span class="censored">do</span> <span class="censored">not</span> <span class="censored">match</span> <span class="censored">something</span> <span class="censored">on</span> <span class="censored">the</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code> <span class="censored">level.</span> <span class="censored">For</span> <span class="censored">example,</span> <span class="censored">if</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code> <span class="censored">has</span> <span class="censored">a</span> <span class="censored">method</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Bar</span></code><span class="censored">,</span> <span class="censored">and</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code> <span class="censored">does</span> <span class="censored">not,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">b.Bar()</span></code> <span class="censored">will</span> <span class="censored">resolve</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">b.A.Bar()</span></code><span class="censored">.</span> <span class="censored">However,</span> <span class="censored">if</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code> <span class="censored">has</span> <span class="censored">a</span> <span class="censored">method</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code><span class="censored">,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">b.Foo</span></code> <span class="censored">resolves</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">b.Foo</span></code><span class="censored">,</span> <span class="censored">not</span> <code class="language-plaintext highlighter-rouge"><span class="censored">b.A.Foo</span></code><span class="censored">,</span> <span class="censored">because</span> <code class="language-plaintext highlighter-rouge"><span class="censored">b</span></code> <span class="censored">has</span> <span class="censored">a</span> <span class="censored">field</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code><span class="censored">.</span></p> <p><span class="censored">Importantly,</span> <span class="censored">any</span> <span class="censored">methods</span> <span class="censored">from</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code> <span class="censored">which</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code> <span class="censored">does</span> <span class="censored">not</span> <span class="censored">already</span> <span class="censored">have</span> <span class="censored">will</span> <span class="censored">be</span> <span class="censored">added</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code><span class="censored">’s</span> <span class="censored">method</span> <span class="censored">set.</span> <span class="censored">So</span> <span class="censored">this</span> <span class="censored">works:</span></p> <div class="codeblock" id="code:5"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="p"><span class="censored">(</span></span>
  <span class="n"><span class="censored">A</span></span> <span class="kt"><span class="censored">int</span></span>
  <span class="n"><span class="censored">B</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{</span></span> <span class="n"><span class="censored">A</span></span> <span class="p"><span class="censored">}</span></span>
  <span class="n"><span class="censored">C</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
    <span class="n"><span class="censored">Foo</span></span><span class="p"><span class="censored">()</span></span>
    <span class="n"><span class="censored">Bar</span></span><span class="p"><span class="censored">()</span></span>
  <span class="p"><span class="censored">}</span></span>
<span class="p"><span class="censored">)</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">A</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Foo</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{}</span></span>
<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">B</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Bar</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{}</span></span>

<span class="k"><span class="censored">var</span></span> <span class="n"><span class="censored">_</span></span> <span class="n"><span class="censored">C</span></span> <span class="o"><span class="censored">=</span></span> <span class="n"><span class="censored">B</span></span><span class="p"><span class="censored">{}</span></span>  <span class="c"><span class="censored">//</span> <span class="censored">B</span> <span class="censored">satisfies</span> <span class="censored">C.</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:5"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Now,</span> <span class="censored">suppose</span> <span class="censored">that</span> <span class="censored">we</span> <span class="censored">were</span> <span class="censored">trying</span> <span class="censored">to</span> <span class="censored">add</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Get()</span> <span class="censored">any</span></code> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code><span class="censored">.</span> <span class="censored">Let’s</span> <span class="censored">suppose</span> <span class="censored">that</span> <span class="censored">we</span> <span class="censored">had</span> <span class="censored">also</span> <span class="censored">defined</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.ValueDefaults</span></code><span class="censored">,</span> <span class="censored">a</span> <span class="censored">type</span> <span class="censored">that</span> <span class="censored">all</span> <span class="censored">satisfiers</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">must</span> <span class="censored">embed.</span> <span class="censored">Then,</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">write</span> <span class="censored">the</span> <span class="censored">following:</span></p> <div class="codeblock" id="code:6"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Value</span></span> <span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">String</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">string</span></span>
  <span class="n"><span class="censored">Set</span></span><span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">string</span></span><span class="p"><span class="censored">)</span></span> <span class="kt"><span class="censored">error</span></span>

  <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="n"><span class="censored">any</span></span>  <span class="c"><span class="censored">//</span> <span class="censored">New</span> <span class="censored">method.</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">ValueDefaults</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ValueDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{</span></span> <span class="k"><span class="censored">return</span></span> <span class="no"><span class="censored">nil</span></span> <span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:6"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Then,</span> <span class="censored">no</span> <span class="censored">code</span> <span class="censored">change</span> <span class="censored">is</span> <span class="censored">required</span> <span class="censored">for</span> <span class="censored">all</span> <span class="censored">clients</span> <span class="censored">to</span> <span class="censored">pick</span> <span class="censored">up</span> <span class="censored">the</span> <span class="censored">new</span> <span class="censored">implementation</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Get()</span></code><span class="censored">.</span></p> <h3 id="required-embeds"><a href="#required-embeds"><span class="censored">Required</span> <span class="censored">Embeds</span></a></h3> <p><span class="censored">Now,</span> <span class="censored">this</span> <span class="censored">only</span> <span class="censored">works</span> <span class="censored">if</span> <span class="censored">we</span> <span class="censored">had</span> <span class="censored">required</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">first</span> <span class="censored">place</span> <span class="censored">that</span> <span class="censored">anyone</span> <span class="censored">satisfying</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">embeds</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.ValueDefaults</span></code><span class="censored">.</span> <span class="censored">How</span> <span class="censored">can</span> <span class="censored">we</span> <span class="censored">force</span> <span class="censored">that?</span></p> <p><span class="censored">A</span> <span class="censored">little-known</span> <span class="censored">Go</span> <span class="censored">feature</span> <span class="censored">is</span> <span class="censored">that</span> <span class="censored">interfaces</span> <span class="censored">can</span> <span class="censored">have</span> <span class="censored">unexported</span> <span class="censored">methods.</span> <span class="censored">The</span> <span class="censored">way</span> <span class="censored">these</span> <span class="censored">work,</span> <span class="censored">for</span> <span class="censored">the</span> <span class="censored">purposes</span> <span class="censored">of</span> <span class="censored">interface</span> <span class="censored">conformance,</span> <span class="censored">is</span> <span class="censored">that</span> <span class="censored">exported</span> <span class="censored">methods</span> <span class="censored">are</span> <span class="censored">matched</span> <span class="censored">just</span> <span class="censored">by</span> <span class="censored">their</span> <span class="censored">name,</span> <span class="censored">but</span> <span class="censored">unexported</span> <span class="censored">methods</span> <span class="censored">must</span> <span class="censored">match</span> <span class="censored">both</span> <span class="censored">name</span> <span class="censored">and</span> <span class="censored">package.</span></p> <p><span class="censored">So,</span> <span class="censored">if</span> <span class="censored">we</span> <span class="censored">have</span> <span class="censored">an</span> <span class="censored">interface</span> <span class="censored">like</span> <code class="language-plaintext highlighter-rouge"><span class="censored">interface</span> <span class="censored">{</span> <span class="censored">foo()</span> <span class="censored">}</span></code><span class="censored">,</span> <span class="censored">then</span> <code class="language-plaintext highlighter-rouge"><span class="censored">foo</span></code> <span class="censored">will</span> <span class="censored">only</span> <span class="censored">match</span> <span class="censored">methods</span> <span class="censored">defined</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">same</span> <span class="censored">package</span> <span class="censored">that</span> <span class="censored">this</span> <span class="censored">interface</span> <span class="censored">expression</span> <span class="censored">appears.</span> <span class="censored">This</span> <span class="censored">is</span> <span class="censored">useful</span> <span class="censored">for</span> <span class="censored">preventing</span> <span class="censored">satisfaction</span> <span class="censored">of</span> <span class="censored">interfaces.</span></p> <p><span class="censored">However,</span> <span class="censored">there</span> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">loophole:</span> <span class="censored">embedding</span> <span class="censored">inherits</span> <span class="censored">the</span> <em><span class="censored">entire</span></em> <span class="censored">method</span> <span class="censored">set,</span> <span class="censored">including</span> <span class="censored">unexported</span> <span class="censored">methods.</span> <span class="censored">Therefore,</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">enhance</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Value</span></code> <span class="censored">to</span> <span class="censored">account</span> <span class="censored">for</span> <span class="censored">this:</span></p> <div class="codeblock" id="code:7"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Value</span></span> <span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">String</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">string</span></span>
  <span class="n"><span class="censored">Set</span></span><span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">string</span></span><span class="p"><span class="censored">)</span></span> <span class="kt"><span class="censored">error</span></span>

  <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="n"><span class="censored">any</span></span>  <span class="c"><span class="censored">//</span> <span class="censored">New</span> <span class="censored">method.</span></span>

  <span class="n"><span class="censored">value</span></span><span class="p"><span class="censored">()</span></span> <span class="c"><span class="censored">//</span> <span class="censored">Unexported!</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">ValueDefaults</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ValueDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{</span></span> <span class="k"><span class="censored">return</span></span> <span class="no"><span class="censored">nil</span></span> <span class="p"><span class="censored">}</span></span>
<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ValueDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">value</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:7"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Now,</span> <span class="censored">it’s</span> <span class="censored">impossible</span> <span class="censored">for</span> <span class="censored">any</span> <span class="censored">type</span> <span class="censored">defined</span> <span class="censored">outside</span> <span class="censored">of</span> <span class="censored">this</span> <span class="censored">package</span> <span class="censored">to</span> <span class="censored">satisfy</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code><span class="censored">,</span> <span class="censored">without</span> <span class="censored">embedding</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.ValueDefaults</span></code> <span class="censored">(either</span> <span class="censored">directly</span> <span class="censored">or</span> <span class="censored">through</span> <span class="censored">another</span> <span class="censored">embedded</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code><span class="censored">).</span></p> <h3 id="exported-struct-fields"><a href="#exported-struct-fields"><span class="censored">Exported</span> <span class="censored">Struct</span> <span class="censored">Fields</span></a></h3> <p><span class="censored">Now,</span> <span class="censored">another</span> <span class="censored">problem</span> <span class="censored">is</span> <span class="censored">that</span> <span class="censored">you</span> <span class="censored">can’t</span> <span class="censored">control</span> <span class="censored">the</span> <span class="censored">name</span> <span class="censored">of</span> <span class="censored">embedded</span> <span class="censored">fields.</span> <span class="censored">If</span> <span class="censored">the</span> <span class="censored">embedded</span> <span class="censored">type</span> <span class="censored">is</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code><span class="censored">,</span> <span class="censored">the</span> <span class="censored">field’s</span> <span class="censored">name</span> <span class="censored">is</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code><span class="censored">.</span> <span class="censored">Except,</span> <span class="censored">it’s</span> <span class="censored">not</span> <span class="censored">based</span> <span class="censored">on</span> <span class="censored">the</span> <span class="censored">name</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">type</span> <span class="censored">itself;</span> <span class="censored">it</span> <span class="censored">will</span> <span class="censored">pick</span> <span class="censored">up</span> <span class="censored">the</span> <span class="censored">name</span> <span class="censored">of</span> <span class="censored">a</span> <span class="censored">type</span> <span class="censored">alias.</span> <span class="censored">So,</span> <span class="censored">if</span> <span class="censored">you</span> <span class="censored">want</span> <span class="censored">to</span> <span class="censored">unexport</span> <span class="censored">the</span> <span class="censored">defaults</span> <span class="censored">struct,</span> <span class="censored">you</span> <span class="censored">can</span> <span class="censored">simply</span> <span class="censored">write:</span></p> <div class="codeblock" id="code:8"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">MyValue</span></span> <span class="k"><span class="censored">struct</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">valueDefaults</span></span>

  <span class="c"><span class="censored">//</span> <span class="censored">...</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">valueDefaults</span></span> <span class="o"><span class="censored">=</span></span> <span class="n"><span class="censored">flag</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">ValueDefaults</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:8"><span class="censored">Go</span></a></div> </div> <p><span class="censored">This</span> <span class="censored">also</span> <span class="censored">has</span> <span class="censored">the</span> <span class="censored">side-effect</span> <span class="censored">of</span> <span class="censored">hiding</span> <span class="censored">all</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">ValueDefaults</span></code><span class="censored">’</span> <span class="censored">methods</span> <span class="censored">from</span> <code class="language-plaintext highlighter-rouge"><span class="censored">MyValue</span></code><span class="censored">’s</span> <span class="censored">documentation,</span> <span class="censored">despite</span> <span class="censored">the</span> <span class="censored">fact</span> <span class="censored">that</span> <span class="censored">exported</span> <span class="censored">and</span> <span class="censored">fields</span> <span class="censored">methods</span> <span class="censored">are</span> <span class="censored">still</span> <span class="censored">selectable</span> <span class="censored">and</span> <span class="censored">callable</span> <span class="censored">by</span> <span class="censored">other</span> <span class="censored">packages</span> <span class="censored">(including</span> <span class="censored">via</span> <span class="censored">interfaces).</span> <span class="censored">As</span> <span class="censored">far</span> <span class="censored">as</span> <span class="censored">I</span> <span class="censored">can</span> <span class="censored">tell,</span> <span class="censored">this</span> <span class="censored">is</span> <span class="censored">simply</span> <span class="censored">a</span> <span class="censored">bug</span> <span class="censored">in</span> <code class="language-plaintext highlighter-rouge"><span class="censored">godoc</span></code><span class="censored">,</span> <span class="censored">since</span> <span class="censored">this</span> <span class="censored">behavior</span> <span class="censored">is</span> <span class="censored">not</span> <span class="censored">documented.</span></p> <h3 id="what-about-same-name-methods"><a href="#what-about-same-name-methods"><span class="censored">What</span> <span class="censored">About</span> <span class="censored">Same-Name</span> <span class="censored">Methods?</span></a></h3> <p><span class="censored">There</span> <span class="censored">is</span> <span class="censored">still</span> <span class="censored">a</span> <span class="censored">failure</span> <span class="censored">mode:</span> <span class="censored">if</span> <span class="censored">a</span> <span class="censored">user</span> <span class="censored">type</span> <span class="censored">satisfying</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">happened</span> <span class="censored">to</span> <span class="censored">define</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Get</span></code> <span class="censored">method</span> <span class="censored">with</span> <span class="censored">a</span> <span class="censored">different</span> <span class="censored">interface.</span> <span class="censored">In</span> <span class="censored">this</span> <span class="censored">case,</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Get</span></code> <span class="censored">takes</span> <span class="censored">precedence,</span> <span class="censored">and</span> <span class="censored">changes</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">will</span> <span class="censored">break</span> <span class="censored">users.</span></p> <p><span class="censored">There</span> <span class="censored">are</span> <span class="censored">two</span> <span class="censored">workarounds:</span></p> <ol> <li> <p><span class="censored">Tell</span> <span class="censored">people</span> <span class="censored">not</span> <span class="censored">to</span> <span class="censored">define</span> <span class="censored">methods</span> <span class="censored">on</span> <span class="censored">their</span> <span class="censored">satisfying</span> <span class="censored">type,</span> <span class="censored">and</span> <span class="censored">if</span> <span class="censored">they</span> <span class="censored">do,</span> <span class="censored">they’re</span> <span class="censored">screwed.</span> <span class="censored">Because</span> <span class="censored">satisfying</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">is</span> <span class="censored">now</span> <span class="censored">explicit,</span> <span class="censored">this</span> <span class="censored">is</span> <span class="censored">not</span> <span class="censored">too</span> <span class="censored">difficult</span> <span class="censored">to</span> <span class="censored">ask</span> <span class="censored">for.</span></p> </li> <li> <p><span class="censored">Pick</span> <span class="censored">a</span> <span class="censored">name</span> <span class="censored">for</span> <span class="censored">new</span> <span class="censored">methods</span> <span class="censored">that</span> <span class="censored">is</span> <span class="censored">unlikely</span> <span class="censored">to</span> <span class="censored">collide</span> <span class="censored">with</span> <span class="censored">anything.</span></p> </li> </ol> <p><span class="censored">Unfortunately,</span> <span class="censored">this</span> <span class="censored">runs</span> <span class="censored">into</span> <span class="censored">a</span> <span class="censored">big</span> <span class="censored">issue</span> <span class="censored">with</span> <span class="censored">structural</span> <span class="censored">typing,</span> <span class="censored">which</span> <span class="censored">is</span> <span class="censored">that</span> <span class="censored">it</span> <span class="censored">is</span> <span class="censored">very</span> <span class="censored">difficult</span> <span class="censored">to</span> <span class="censored">avoid</span> <span class="censored">making</span> <span class="censored">mistakes</span> <span class="censored">when</span> <span class="censored">making</span> <span class="censored">changes,</span> <span class="censored">due</span> <span class="censored">to</span> <span class="censored">the</span> <span class="censored">lack</span> <span class="censored">of</span> <span class="censored">intent</span> <span class="censored">involved.</span> <span class="censored">A</span> <span class="censored">similar</span> <span class="censored">problem</span> <span class="censored">occurs</span> <span class="censored">with</span> <span class="censored">C++</span> <span class="censored">templates,</span> <span class="censored">where</span> <span class="censored">the</span> <span class="censored">interfaces</span> <span class="censored">defined</span> <span class="censored">by</span> <span class="censored">concepts</span> <span class="censored">are</span> <span class="censored">implicit,</span> <span class="censored">and</span> <span class="censored">can</span> <span class="censored">result</span> <span class="censored">in</span> <span class="censored">violating</span> <span class="censored">contract</span> <span class="censored">expectations.</span></p> <p><span class="censored">Go</span> <span class="censored">has</span> <span class="censored">historically</span> <span class="censored">be</span> <span class="censored">relatively</span> <span class="censored">cavalier</span> <span class="censored">about</span> <span class="censored">this</span> <span class="censored">kind</span> <span class="censored">of</span> <span class="censored">issue,</span> <span class="censored">so</span> <span class="censored">I</span> <span class="censored">think</span> <span class="censored">that</span> <span class="censored">breaking</span> <span class="censored">people</span> <span class="censored">based</span> <span class="censored">on</span> <span class="censored">this</span> <span class="censored">is</span> <span class="censored">fine.</span></p> <p><span class="censored">And</span> <span class="censored">of</span> <span class="censored">course,</span> <span class="censored">you</span> <span class="censored">cannot</span> <span class="censored">retrofit</span> <span class="censored">a</span> <span class="censored">default</span> <span class="censored">struct</span> <span class="censored">into</span> <span class="censored">a</span> <span class="censored">interface;</span> <span class="censored">you</span> <span class="censored">have</span> <span class="censored">to</span> <span class="censored">define</span> <span class="censored">it</span> <span class="censored">from</span> <span class="censored">day</span> <span class="censored">one.</span></p> <h2 id="using-defaults"><a href="#using-defaults"><span class="censored">Using</span> <span class="censored">Defaults</span></a></h2> <p><span class="censored">Now</span> <span class="censored">that</span> <span class="censored">we</span> <span class="censored">have</span> <span class="censored">defaults,</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">also</span> <span class="censored">enhance</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">with</span> <span class="censored">bool</span> <span class="censored">flag</span> <span class="censored">detection:</span></p> <div class="codeblock" id="code:9"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Value</span></span> <span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">String</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">string</span></span>
  <span class="n"><span class="censored">Set</span></span><span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">string</span></span><span class="p"><span class="censored">)</span></span> <span class="kt"><span class="censored">error</span></span>

  <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="n"><span class="censored">any</span></span>
  <span class="n"><span class="censored">IsBoolFlag</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">bool</span></span>

  <span class="n"><span class="censored">value</span></span><span class="p"><span class="censored">()</span></span> <span class="c"><span class="censored">//</span> <span class="censored">Unexported!</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">ValueDefaults</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ValueDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{</span></span> <span class="k"><span class="censored">return</span></span> <span class="no"><span class="censored">nil</span></span> <span class="p"><span class="censored">}</span></span>
<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ValueDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">IsBoolFlag</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{</span></span> <span class="k"><span class="censored">return</span></span> <span class="no"><span class="censored">false</span></span> <span class="p"><span class="censored">}</span></span>
<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ValueDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">value</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:9"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Now</span> <code class="language-plaintext highlighter-rouge"><span class="censored">IsBoolFlag</span></code> <span class="censored">is</span> <span class="censored">more</span> <span class="censored">than</span> <span class="censored">just</span> <span class="censored">a</span> <span class="censored">random</span> <span class="censored">throw-away</span> <span class="censored">comment</span> <span class="censored">on</span> <span class="censored">a</span> <span class="censored">type.</span></p> <p><span class="censored">We</span> <span class="censored">can</span> <span class="censored">also</span> <span class="censored">use</span> <span class="censored">defaults</span> <span class="censored">to</span> <span class="censored">speed</span> <span class="censored">up</span> <span class="censored">side</span> <span class="censored">casts.</span> <span class="censored">Many</span> <span class="censored">functions</span> <span class="censored">around</span> <span class="censored">the</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io</span></code> <span class="censored">package</span> <span class="censored">will</span> <span class="censored">cast</span> <span class="censored">an</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.Reader</span></code> <span class="censored">into</span> <span class="censored">an</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.Seeker</span></code> <span class="censored">or</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.ReadAt</span></code> <span class="censored">to</span> <span class="censored">perform</span> <span class="censored">more</span> <span class="censored">efficient</span> <span class="censored">I/O.</span></p> <p><span class="censored">In</span> <span class="censored">a</span> <span class="censored">hypothetical</span> <span class="censored">world</span> <span class="censored">where</span> <span class="censored">we</span> <span class="censored">had</span> <span class="censored">defaults</span> <span class="censored">structs</span> <span class="censored">for</span> <span class="censored">all</span> <span class="censored">the</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io</span></code> <span class="censored">interfaces,</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">enhance</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.Reader</span></code> <span class="censored">with</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">ReadAt</span></code> <span class="censored">default</span> <span class="censored">method</span> <span class="censored">that</span> <span class="censored">by</span> <span class="censored">default</span> <span class="censored">returns</span> <span class="censored">an</span> <span class="censored">error.</span></p> <div class="codeblock" id="code:10"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Reader</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Read</span></span><span class="p"><span class="censored">([]</span></span><span class="kt"><span class="censored">byte</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">int</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">error</span></span><span class="p"><span class="censored">)</span></span>
  <span class="n"><span class="censored">ReadAt</span></span><span class="p"><span class="censored">([]</span></span><span class="kt"><span class="censored">byte</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">int64</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">int</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">error</span></span><span class="p"><span class="censored">)</span></span>

  <span class="n"><span class="censored">reader</span></span><span class="p"><span class="censored">()</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">ReaderDefaults</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ReaderDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">ReadAt</span></span><span class="p"><span class="censored">([]</span></span><span class="kt"><span class="censored">byte</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">int64</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">int</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">error</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="k"><span class="censored">return</span></span> <span class="m"><span class="censored">0</span></span><span class="p"><span class="censored">,</span></span> <span class="n"><span class="censored">errors</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">ErrUnsupported</span></span>
<span class="p"><span class="censored">}</span></span>
<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ReaderDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">reader</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:10"><span class="censored">Go</span></a></div> </div> <p><span class="censored">We</span> <span class="censored">can</span> <span class="censored">do</span> <span class="censored">something</span> <span class="censored">similar</span> <span class="censored">for</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.Seeker</span></code><span class="censored">,</span> <span class="censored">but</span> <span class="censored">because</span> <span class="censored">it’s</span> <span class="censored">a</span> <span class="censored">rather</span> <span class="censored">general</span> <span class="censored">interface,</span> <span class="censored">it’s</span> <span class="censored">better</span> <span class="censored">to</span> <span class="censored">keep</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.Seeker</span></code> <span class="censored">as-is.</span> <span class="censored">So,</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">add</span> <span class="censored">a</span> <span class="censored">conversion</span> <span class="censored">method:</span></p> <div class="codeblock" id="code:11"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Reader</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Seeker</span></span><span class="p"><span class="censored">()</span></span> <span class="n"><span class="censored">io</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">Seeker</span></span>

  <span class="c"><span class="censored">//</span> <span class="censored">...</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">ReaderDefaults</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">ReaderDefaults</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Seeker</span></span><span class="p"><span class="censored">([]</span></span><span class="kt"><span class="censored">byte</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">int64</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">io</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">Seeker</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="k"><span class="censored">return</span></span> <span class="no"><span class="censored">nil</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:11"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Here,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Reader.Seeker()</span></code> <span class="censored">converts</span> <span class="censored">to</span> <span class="censored">an</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.Seeker</span></code><span class="censored">,</span> <span class="censored">returning</span> <code class="language-plaintext highlighter-rouge"><span class="censored">nil</span></code> <span class="censored">if</span> <span class="censored">that’s</span> <span class="censored">not</span> <span class="censored">possible.</span> <span class="censored">How</span> <span class="censored">is</span> <span class="censored">this</span> <span class="censored">faster</span> <span class="censored">than</span> <code class="language-plaintext highlighter-rouge"><span class="censored">r.(io.Seeker)</span></code><span class="censored">?</span> <span class="censored">Well,</span> <span class="censored">consider</span> <span class="censored">what</span> <span class="censored">this</span> <span class="censored">would</span> <span class="censored">look</span> <span class="censored">like</span> <span class="censored">in</span> <span class="censored">user</span> <span class="censored">code:</span></p> <div class="codeblock" id="code:12"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">MyIO</span></span> <span class="k"><span class="censored">struct</span></span><span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">io</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">ReaderDefaults</span></span>
  <span class="c"><span class="censored">//</span> <span class="censored">...</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">m</span></span> <span class="o"><span class="censored">*</span></span><span class="n"><span class="censored">MyIO</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Read</span></span><span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">b</span></span> <span class="p"><span class="censored">[]</span></span><span class="kt"><span class="censored">byte</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">int</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">error</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">{</span></span> <span class="c"><span class="censored">/*</span> <span class="censored">...</span> <span class="censored">*/</span></span> <span class="p"><span class="censored">}</span></span>
<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">m</span></span> <span class="o"><span class="censored">*</span></span><span class="n"><span class="censored">MyIO</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Seek</span></span><span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">offset</span></span> <span class="kt"><span class="censored">int64</span></span><span class="p"><span class="censored">,</span></span> <span class="n"><span class="censored">whence</span></span> <span class="kt"><span class="censored">int</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">int64</span></span><span class="p"><span class="censored">,</span></span> <span class="kt"><span class="censored">error</span></span><span class="p"><span class="censored">)</span></span> <span class="p"><span class="censored">{</span></span> <span class="c"><span class="censored">/*</span> <span class="censored">...</span> <span class="censored">*/</span></span> <span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">m</span></span> <span class="o"><span class="censored">*</span></span><span class="n"><span class="censored">MyIO</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Seeker</span></span><span class="p"><span class="censored">()</span></span> <span class="n"><span class="censored">io</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">Seeker</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="k"><span class="censored">return</span></span> <span class="n"><span class="censored">m</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:12"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Calling</span> <code class="language-plaintext highlighter-rouge"><span class="censored">r.Seeker()</span></code><span class="censored">,</span> <span class="censored">if</span> <code class="language-plaintext highlighter-rouge"><span class="censored">r</span></code> <span class="censored">is</span> <span class="censored">an</span> <code class="language-plaintext highlighter-rouge"><span class="censored">io.Reader</span></code> <span class="censored">containing</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">MyIO</span></code><span class="censored">,</span> <span class="censored">lowers</span> <span class="censored">to</span> <span class="censored">the</span> <span class="censored">following</span> <span class="censored">machine</span> <span class="censored">code:</span></p> <ol> <li> <span class="censored">Load</span> <span class="censored">the</span> <span class="censored">function</span> <span class="censored">pointer</span> <span class="censored">for</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Seeker</span></code> <span class="censored">out</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">r</span></code><span class="censored">’s</span> <span class="censored">itab.</span> </li> <li> <span class="censored">Perform</span> <span class="censored">an</span> <span class="censored">indirect</span> <span class="censored">jump</span> <span class="censored">on</span> <span class="censored">that</span> <span class="censored">function</span> <span class="censored">pointer.</span> </li> <li> <span class="censored">Inside</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">(*MyIO).Seeker</span></code><span class="censored">,</span> <span class="censored">load</span> <span class="censored">a</span> <span class="censored">pointer</span> <span class="censored">to</span> <span class="censored">the</span> <span class="censored">itab</span> <span class="censored">symbol</span> <code class="language-plaintext highlighter-rouge"><span class="censored">go:itab.*MyIO,io.Seeker</span></code> <span class="censored">and</span> <code class="language-plaintext highlighter-rouge"><span class="censored">m</span></code> <span class="censored">into</span> <span class="censored">the</span> <span class="censored">return</span> <span class="censored">slots.</span> </li> <li><span class="censored">Return.</span></li> </ol> <p><span class="censored">The</span> <span class="censored">main</span> <span class="censored">cost</span> <span class="censored">of</span> <span class="censored">this</span> <span class="censored">conversion</span> <span class="censored">is</span> <span class="censored">the</span> <span class="censored">indirect</span> <span class="censored">jump,</span> <span class="censored">compared</span> <span class="censored">to,</span> <span class="censored">at</span> <span class="censored">minimum,</span> <span class="censored">hitting</span> <span class="censored">a</span> <span class="censored">hashmap</span> <span class="censored">lookup</span> <span class="censored">loop</span> <span class="censored">for</span> <span class="censored">the</span> <span class="censored">cache</span> <span class="censored">for</span> <code class="language-plaintext highlighter-rouge"><span class="censored">r.(io.Seeker)</span></code><span class="censored">.</span></p> <p><span class="censored">Does</span> <span class="censored">this</span> <span class="censored">performance</span> <span class="censored">matter?</span> <span class="censored">Not</span> <span class="censored">for</span> <span class="censored">I/O</span> <span class="censored">interfaces,</span> <span class="censored">probably,</span> <span class="censored">but</span> <span class="censored">it</span> <em><span class="censored">can</span></em> <span class="censored">matter</span> <span class="censored">for</span> <span class="censored">some</span> <span class="censored">uses!</span></p> <h2 id="shouldnt-this-be-a-language-feature"><a href="#shouldnt-this-be-a-language-feature"><span class="censored">Shouldn’t</span> <span class="censored">This</span> <span class="censored">Be</span> <span class="censored">a</span> <span class="censored">Language</span> <span class="censored">Feature?</span></a></h2> <p><span class="censored">Yes,</span> <span class="censored">it</span> <span class="censored">should,</span> <span class="censored">but</span> <span class="censored">here</span> <span class="censored">we</span> <span class="censored">are.</span> <span class="censored">Although</span> <span class="censored">making</span> <span class="censored">it</span> <span class="censored">a</span> <span class="censored">language</span> <span class="censored">feature</span> <span class="censored">has</span> <span class="censored">a</span> <span class="censored">few</span> <span class="censored">rather</span> <span class="censored">unfortunate</span> <span class="censored">quirks</span> <span class="censored">that</span> <span class="censored">we</span> <span class="censored">need</span> <span class="censored">to</span> <span class="censored">keep</span> <span class="censored">in</span> <span class="censored">mind.</span></p> <p><span class="censored">Suppose</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">define</span> <span class="censored">defaults</span> <span class="censored">on</span> <span class="censored">interface</span> <span class="censored">methods</span> <span class="censored">somehow,</span> <span class="censored">like</span> <span class="censored">this:</span></p> <div class="codeblock" id="code:13"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Foo</span></span> <span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Bar</span></span><span class="p"><span class="censored">()</span></span>
  <span class="n"><span class="censored">Baz</span></span><span class="p"><span class="censored">()</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">func</span></span> <span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">f</span></span> <span class="n"><span class="censored">Foo</span></span><span class="p"><span class="censored">)</span></span> <span class="n"><span class="censored">Baz</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="c"><span class="censored">//</span> <span class="censored">...</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:13"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Then,</span> <span class="censored">any</span> <span class="censored">type</span> <span class="censored">which</span> <span class="censored">provides</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Bar()</span></code> <span class="censored">automatically</span> <span class="censored">satisfies</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code><span class="censored">.</span> <span class="censored">Suppose</span> <code class="language-plaintext highlighter-rouge"><span class="censored">MyFoo</span></code> <span class="censored">satisfies</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code><span class="censored">,</span> <span class="censored">but</span> <span class="censored">does</span> <span class="censored">not</span> <span class="censored">provide</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code><span class="censored">.</span> <span class="censored">Then</span> <span class="censored">we</span> <span class="censored">have</span> <span class="censored">a</span> <span class="censored">problem:</span></p> <div class="codeblock" id="code:14"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">var</span></span> <span class="n"><span class="censored">x</span></span> <span class="n"><span class="censored">MyFoo</span></span>
<span class="n"><span class="censored">x</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">Baz</span></span><span class="p"><span class="censored">()</span></span>       <span class="c"><span class="censored">//</span> <span class="censored">Error!</span></span>
<span class="n"><span class="censored">Foo</span></span><span class="p"><span class="censored">(</span></span><span class="n"><span class="censored">x</span></span><span class="p"><span class="censored">)</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">Baz</span></span><span class="p"><span class="censored">()</span></span>  <span class="c"><span class="censored">//</span> <span class="censored">Ok!</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:14"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Now,</span> <span class="censored">we</span> <span class="censored">might</span> <span class="censored">consider</span> <span class="censored">looking</span> <span class="censored">past</span> <span class="censored">that,</span> <span class="censored">but</span> <span class="censored">it</span> <span class="censored">becomes</span> <span class="censored">a</span> <span class="censored">big</span> <span class="censored">problem</span> <span class="censored">with</span> <span class="censored">reflection.</span> <span class="censored">If</span> <span class="censored">we</span> <span class="censored">passed</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo(x)</span></code> <span class="censored">into</span> <code class="language-plaintext highlighter-rouge"><span class="censored">reflect.ValueOf</span></code><span class="censored">,</span> <span class="censored">the</span> <span class="censored">resulting</span> <code class="language-plaintext highlighter-rouge"><span class="censored">any</span></code> <span class="censored">conversion</span> <span class="censored">would</span> <span class="censored">discard</span> <span class="censored">the</span> <span class="censored">defaulted</span> <span class="censored">method,</span> <span class="censored">meaning</span> <span class="censored">that</span> <span class="censored">it</span> <span class="censored">would</span> <span class="censored">not</span> <span class="censored">be</span> <span class="censored">findable</span> <span class="censored">by</span> <code class="language-plaintext highlighter-rouge"><span class="censored">reflect.Value.MethodByName()</span></code><span class="censored">.</span> <span class="censored">Oops.</span></p> <p><span class="censored">So</span> <span class="censored">we</span> <span class="censored">need</span> <span class="censored">to</span> <span class="censored">somehow</span> <span class="censored">add</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">MyFoo</span></code><span class="censored">’s</span> <span class="censored">method</span> <span class="censored">set.</span> <span class="censored">Maybe</span> <span class="censored">we</span> <span class="censored">say</span> <span class="censored">that</span> <span class="censored">if</span> <code class="language-plaintext highlighter-rouge"><span class="censored">MyFoo</span></code> <span class="censored">is</span> <span class="censored">ever</span> <span class="censored">converted</span> <span class="censored">into</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code><span class="censored">,</span> <span class="censored">it</span> <span class="censored">gets</span> <span class="censored">the</span> <span class="censored">method.</span> <span class="censored">But</span> <span class="censored">this</span> <span class="censored">doesn’t</span> <span class="censored">work,</span> <span class="censored">because</span> <span class="censored">the</span> <span class="censored">compiler</span> <span class="censored">might</span> <span class="censored">not</span> <span class="censored">be</span> <span class="censored">able</span> <span class="censored">to</span> <span class="censored">see</span> <span class="censored">through</span> <span class="censored">something</span> <span class="censored">like</span> <code class="language-plaintext highlighter-rouge"><span class="censored">any(MyFoo{...}).(Foo)</span></code><span class="censored">.</span> <span class="censored">This</span> <span class="censored">means</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code> <span class="censored">must</span> <span class="censored">be</span> <span class="censored">applied</span> <span class="censored">unconditionally.</span> <span class="censored">But,</span> <span class="censored">now</span> <span class="censored">we</span> <span class="censored">have</span> <span class="censored">the</span> <span class="censored">problem</span> <span class="censored">that</span> <span class="censored">if</span> <span class="censored">we</span> <span class="censored">have</span> <span class="censored">another</span> <span class="censored">interface</span> <code class="language-plaintext highlighter-rouge"><span class="censored">interface</span> <span class="censored">{</span> <span class="censored">Bar();</span> <span class="censored">Baz(int)</span> <span class="censored">}</span></code><span class="censored">,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">MyFoo</span></code> <span class="censored">would</span> <span class="censored">need</span> <span class="censored">to</span> <span class="censored">receive</span> <span class="censored">incompatible</span> <span class="censored">signatures</span> <span class="censored">for</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code><span class="censored">.</span></p> <p><span class="censored">Again,</span> <span class="censored">we’re</span> <span class="censored">screwed</span> <span class="censored">by</span> <span class="censored">the</span> <span class="censored">non-intentionality</span> <span class="censored">of</span> <span class="censored">structural</span> <span class="censored">typing.</span></p> <h3 id="missing-methods"><a href="#missing-methods"><span class="censored">Missing</span> <span class="censored">Methods</span></a></h3> <p><span class="censored">Ok,</span> <span class="censored">let’s</span> <span class="censored">forget</span> <span class="censored">about</span> <span class="censored">default</span> <span class="censored">method</span> <span class="censored">implementations,</span> <span class="censored">that</span> <span class="censored">doesn’t</span> <span class="censored">seem</span> <span class="censored">to</span> <span class="censored">be</span> <span class="censored">workable.</span> <span class="censored">What</span> <span class="censored">if</span> <span class="censored">we</span> <span class="censored">make</span> <span class="censored">some</span> <span class="censored">methods</span> <span class="censored">optional,</span> <span class="censored">like</span> <code class="language-plaintext highlighter-rouge"><span class="censored">IsBoolFlag()</span></code> <span class="censored">earlier?</span> <span class="censored">Let’s</span> <span class="censored">invent</span> <span class="censored">some</span> <span class="censored">syntax</span> <span class="censored">for</span> <span class="censored">it.</span></p> <div class="codeblock" id="code:15"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Foo</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Bar</span></span><span class="p"><span class="censored">()</span></span>
  <span class="err"><span class="censored">?</span></span><span class="n"><span class="censored">Baz</span></span><span class="p"><span class="censored">()</span></span> <span class="c"><span class="censored">//</span> <span class="censored">Optional</span> <span class="censored">method.</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:15"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Then,</span> <span class="censored">suppose</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">MyFoo</span></code> <span class="censored">provides</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Bar</span></code> <span class="censored">but</span> <span class="censored">not</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code> <span class="censored">(or</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code> <span class="censored">with</span> <span class="censored">the</span> <span class="censored">wrong</span> <span class="censored">signature).</span> <span class="censored">Then,</span> <span class="censored">the</span> <span class="censored">entry</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">itab</span> <span class="censored">for</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code> <span class="censored">would</span> <span class="censored">contain</span> <span class="censored">a</span> <span class="censored">nil</span> <span class="censored">function</span> <span class="censored">pointer,</span> <span class="censored">such</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">x.Baz()</span></code> <span class="censored">panics!</span> <span class="censored">To</span> <span class="censored">determine</span> <span class="censored">if</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code> <span class="censored">is</span> <span class="censored">safe</span> <span class="censored">to</span> <span class="censored">call,</span> <span class="censored">we</span> <span class="censored">would</span> <span class="censored">use</span> <span class="censored">the</span> <span class="censored">following</span> <span class="censored">idiom:</span></p> <div class="codeblock" id="code:16"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">if</span></span> <span class="n"><span class="censored">x</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">Baz</span></span> <span class="o"><span class="censored">!=</span></span> <span class="no"><span class="censored">nil</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">x</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">Baz</span></span><span class="p"><span class="censored">()</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:16"><span class="censored">Go</span></a></div> </div> <p><span class="censored">The</span> <span class="censored">compiler</span> <span class="censored">is</span> <span class="censored">already</span> <span class="censored">smart</span> <span class="censored">enough</span> <span class="censored">to</span> <span class="censored">elide</span> <span class="censored">construction</span> <span class="censored">of</span> <span class="censored">funcvals</span> <span class="censored">for</span> <span class="censored">cases</span> <span class="censored">like</span> <span class="censored">this,</span> <span class="censored">although</span> <span class="censored">it</span> <span class="censored">does</span> <span class="censored">mean</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">x.Func</span></code> <span class="censored">in</span> <span class="censored">general,</span> <span class="censored">for</span> <span class="censored">an</span> <span class="censored">interface</span> <span class="censored">value</span> <code class="language-plaintext highlighter-rouge"><span class="censored">x</span></code><span class="censored">,</span> <span class="censored">requires</span> <span class="censored">an</span> <span class="censored">extra</span> <code class="language-plaintext highlighter-rouge"><span class="censored">cmov</span></code> <span class="censored">or</span> <span class="censored">similar</span> <span class="censored">to</span> <span class="censored">make</span> <span class="censored">sure</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">x.Func</span></code> <span class="censored">is</span> <span class="censored">nil</span> <span class="censored">when</span> <span class="censored">it’s</span> <span class="censored">a</span> <span class="censored">missing</span> <span class="censored">method.</span></p> <p><span class="censored">All</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">use</span> <span class="censored">cases</span> <span class="censored">described</span> <span class="censored">above</span> <span class="censored">would</span> <span class="censored">work</span> <span class="censored">Just</span> <span class="censored">Fine</span> <span class="censored">using</span> <span class="censored">this</span> <span class="censored">construction,</span> <span class="censored">though!</span> <span class="censored">However,</span> <span class="censored">we</span> <span class="censored">run</span> <span class="censored">into</span> <span class="censored">the</span> <span class="censored">same</span> <span class="censored">issue</span> <span class="censored">that</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo(x)</span></code> <span class="censored">appears</span> <span class="censored">to</span> <span class="censored">have</span> <span class="censored">a</span> <span class="censored">larger</span> <span class="censored">method</span> <span class="censored">set</span> <span class="censored">than</span> <code class="language-plaintext highlighter-rouge"><span class="censored">x</span></code><span class="censored">.</span> <span class="censored">It</span> <span class="censored">is</span> <span class="censored">not</span> <span class="censored">clear</span> <span class="censored">if</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo(x)</span></code> <span class="censored">should</span> <span class="censored">conform</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">interface</span> <span class="censored">{</span> <span class="censored">Bar();</span> <span class="censored">Baz()</span> <span class="censored">}</span></code><span class="censored">,</span> <span class="censored">where</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Baz</span></code> <span class="censored">is</span> <span class="censored">required.</span> <span class="censored">My</span> <span class="censored">intuition</span> <span class="censored">would</span> <span class="censored">be</span> <span class="censored">no:</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Foo</span></code> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">strictly</span> <span class="censored">weaker</span> <span class="censored">interface.</span> <span class="censored">Perhaps</span> <span class="censored">it</span> <span class="censored">might</span> <span class="censored">be</span> <span class="censored">necessary</span> <span class="censored">to</span> <span class="censored">avoid</span> <span class="censored">the</span> <span class="censored">method</span> <span class="censored">access</span> <span class="censored">syntax</span> <span class="censored">for</span> <span class="censored">optional</span> <span class="censored">methods,</span> <span class="censored">but</span> <span class="censored">that’s</span> <span class="censored">a</span> <span class="censored">question</span> <span class="censored">of</span> <span class="censored">aesthetics.</span></p> <p><span class="censored">This</span> <span class="censored">idea</span> <span class="censored">of</span> <span class="censored">having</span> <span class="censored">nulls</span> <span class="censored">in</span> <span class="censored">place</span> <span class="censored">of</span> <span class="censored">function</span> <span class="censored">pointers</span> <span class="censored">in</span> <span class="censored">a</span> <span class="censored">vtable</span> <span class="censored">is</span> <span class="censored">not</span> <span class="censored">new,</span> <span class="censored">but</span> <span class="censored">to</span> <span class="censored">my</span> <span class="censored">knowledge</span> <span class="censored">is</span> <span class="censored">not</span> <span class="censored">used</span> <span class="censored">especially</span> <span class="censored">widely.</span> <span class="censored">It</span> <span class="censored">would</span> <span class="censored">be</span> <span class="censored">very</span> <span class="censored">useful</span> <span class="censored">in</span> <span class="censored">C++,</span> <span class="censored">for</span> <span class="censored">example,</span> <span class="censored">to</span> <span class="censored">be</span> <span class="censored">able</span> <span class="censored">to</span> <span class="censored">determine</span> <span class="censored">if</span> <span class="censored">no</span> <span class="censored">implementation</span> <span class="censored">was</span> <span class="censored">provided</span> <span class="censored">for</span> <span class="censored">a</span> <span class="censored">non-pure</span> <span class="censored">virtual</span> <span class="censored">function.</span> <span class="censored">However,</span> <span class="censored">the</span> <span class="censored">nominal</span> <span class="censored">nature</span> <span class="censored">of</span> <span class="censored">C++’s</span> <span class="censored">virtual</span> <span class="censored">functions</span> <span class="censored">does</span> <span class="censored">not</span> <span class="censored">make</span> <span class="censored">this</span> <em><span class="censored">as</span> <span class="censored">big</span></em> <span class="censored">of</span> <span class="censored">a</span> <span class="censored">need.</span></p> <h3 id="related-interfaces"><a href="#related-interfaces"><span class="censored">Related</span> <span class="censored">Interfaces</span></a></h3> <p><span class="censored">Another</span> <span class="censored">alternative</span> <span class="censored">is</span> <span class="censored">to</span> <span class="censored">store</span> <span class="censored">a</span> <span class="censored">related</span> <span class="censored">interfaces’</span> <span class="censored">itabs</span> <span class="censored">on</span> <span class="censored">in</span> <span class="censored">an</span> <span class="censored">itab.</span> <span class="censored">For</span> <span class="censored">example,</span> <span class="censored">suppose</span> <span class="censored">that</span> <span class="censored">we</span> <span class="censored">invent</span> <span class="censored">the</span> <span class="censored">syntax</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A&lt;-</span></code> <span class="censored">within</span> <span class="censored">an</span> <code class="language-plaintext highlighter-rouge"><span class="censored">interface{}</span></code> <span class="censored">to</span> <span class="censored">indicate</span> <span class="censored">that</span> <span class="censored">that</span> <span class="censored">interface</span> <span class="censored">will</span> <span class="censored">likely</span> <span class="censored">get</span> <span class="censored">cast</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code><span class="censored">.</span> <span class="censored">For</span> <span class="censored">example:</span></p> <div class="codeblock" id="code:17"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="p"><span class="censored">(</span></span>
  <span class="n"><span class="censored">A</span></span> <span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span>
    <span class="n"><span class="censored">Foo</span></span><span class="p"><span class="censored">()</span></span>
  <span class="p"><span class="censored">}</span></span>

  <span class="n"><span class="censored">B</span></span> <span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span>
    <span class="n"><span class="censored">Bar</span></span><span class="p"><span class="censored">()</span></span>

    <span class="n"><span class="censored">A</span></span><span class="o"><span class="censored">&lt;-</span></span>
  <span class="p"><span class="censored">}</span></span>
<span class="p"><span class="censored">)</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:17"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Satisfying</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code> <span class="censored">does</span> <span class="censored">not</span> <span class="censored">require</span> <span class="censored">satisfying</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code><span class="censored">.</span> <span class="censored">However,</span> <span class="censored">the</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A&lt;-</span></code> <span class="censored">must</span> <span class="censored">be</span> <span class="censored">part</span> <span class="censored">of</span> <span class="censored">public</span> <span class="censored">API,</span> <span class="censored">because</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">interface{</span> <span class="censored">Bar()</span> <span class="censored">}</span></code> <span class="censored">cannot</span> <span class="censored">be</span> <span class="censored">used</span> <span class="censored">in</span> <span class="censored">place</span> <span class="censored">of</span> <span class="censored">an</span> <code class="language-plaintext highlighter-rouge"><span class="censored">interface{</span> <span class="censored">A&lt;-</span> <span class="censored">}</span></code></p> <p><span class="censored">Within</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code><span class="censored">’s</span> <span class="censored">itab,</span> <span class="censored">after</span> <span class="censored">all</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">methods,</span> <span class="censored">there</span> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">pointer</span> <span class="censored">to</span> <span class="censored">an</span> <span class="censored">itab</span> <span class="censored">for</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code><span class="censored">,</span> <span class="censored">if</span> <span class="censored">the</span> <span class="censored">concrete</span> <span class="censored">type</span> <span class="censored">for</span> <span class="censored">this</span> <span class="censored">itab</span> <span class="censored">also</span> <span class="censored">happens</span> <span class="censored">to</span> <span class="censored">satisfy</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code><span class="censored">.</span> <span class="censored">Then,</span> <span class="censored">a</span> <span class="censored">cast</span> <span class="censored">from</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code> <span class="censored">is</span> <span class="censored">just</span> <span class="censored">loading</span> <span class="censored">a</span> <span class="censored">pointer</span> <span class="censored">from</span> <span class="censored">the</span> <span class="censored">itab.</span> <span class="censored">If</span> <span class="censored">the</span> <span class="censored">cast</span> <span class="censored">would</span> <span class="censored">fail,</span> <span class="censored">the</span> <span class="censored">loaded</span> <span class="censored">pointer</span> <span class="censored">will</span> <span class="censored">be</span> <code class="language-plaintext highlighter-rouge"><span class="censored">nil</span></code><span class="censored">.</span></p> <p><span class="censored">I</span> <span class="censored">had</span> <span class="censored">always</span> <span class="censored">assumed</span> <span class="censored">that</span> <span class="censored">Go</span> <span class="censored">did</span> <span class="censored">an</span> <span class="censored">optimization</span> <span class="censored">like</span> <span class="censored">this</span> <span class="censored">for</span> <span class="censored">embedding</span> <span class="censored">interfaces,</span> <span class="censored">but</span> <span class="censored">no!</span> <em><span class="censored">Any</span></em> <span class="censored">inter-interface</span> <span class="censored">conversion,</span> <span class="censored">including</span> <span class="censored">upcasts,</span> <span class="censored">goes</span> <span class="censored">through</span> <span class="censored">the</span> <span class="censored">whole</span> <span class="censored">type</span> <span class="censored">assertion</span> <span class="censored">machinery!</span> <span class="censored">Of</span> <span class="censored">course,</span> <span class="censored">Go</span> <span class="censored">cannot</span> <span class="censored">hope</span> <span class="censored">to</span> <span class="censored">generate</span> <span class="censored">an</span> <span class="censored">itab</span> <span class="censored">for</span> <span class="censored">every</span> <span class="censored">possible</span> <span class="censored">subset</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">method</span> <span class="censored">set</span> <span class="censored">of</span> <span class="censored">an</span> <span class="censored">interface</span> <span class="censored">(exponential</span> <span class="censored">blow-up),</span> <span class="censored">but</span> <span class="censored">it’s</span> <span class="censored">surprising</span> <span class="censored">that</span> <span class="censored">they</span> <span class="censored">don’t</span> <span class="censored">do</span> <span class="censored">this</span> <span class="censored">for</span> <span class="censored">embedded</span> <span class="censored">interfaces,</span> <span class="censored">which</span> <span class="censored">are</span> <span class="censored">Go’s</span> <span class="censored">equivalent</span> <span class="censored">of</span> <span class="censored">superinterfaces</span> <span class="censored">(present</span> <span class="censored">in</span> <span class="censored">basically</span> <span class="censored">every</span> <span class="censored">language</span> <span class="censored">with</span> <span class="censored">interfaces).</span></p> <p><span class="censored">Using</span> <span class="censored">this</span> <span class="censored">feature,</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">update</span> <code class="language-plaintext highlighter-rouge"><span class="censored">flag.Value</span></code> <span class="censored">to</span> <span class="censored">look</span> <span class="censored">like</span> <span class="censored">this:</span></p> <div class="codeblock" id="code:18"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Value</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">String</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">string</span></span>
  <span class="n"><span class="censored">Set</span></span><span class="p"><span class="censored">(</span></span><span class="kt"><span class="censored">string</span></span><span class="p"><span class="censored">)</span></span> <span class="kt"><span class="censored">error</span></span>

  <span class="n"><span class="censored">BoolValue</span></span><span class="o"><span class="censored">&lt;-</span></span>
  <span class="n"><span class="censored">Getter</span></span><span class="o"><span class="censored">&lt;-</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">BoolValue</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Value</span></span>
  <span class="n"><span class="censored">IsBoolFlag</span></span><span class="p"><span class="censored">()</span></span> <span class="kt"><span class="censored">bool</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">Getter</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Value</span></span>
  <span class="n"><span class="censored">Get</span></span><span class="p"><span class="censored">()</span></span> <span class="n"><span class="censored">any</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:18"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Unfortunately,</span> <span class="censored">because</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A&lt;-</span></code> <span class="censored">changes</span> <span class="censored">the</span> <span class="censored">ABI</span> <span class="censored">of</span> <span class="censored">an</span> <span class="censored">interface,</span> <span class="censored">it</span> <span class="censored">does</span> <span class="censored">not</span> <span class="censored">seem</span> <span class="censored">possible</span> <span class="censored">to</span> <span class="censored">actually</span> <span class="censored">add</span> <span class="censored">this</span> <span class="censored">to</span> <span class="censored">existing</span> <span class="censored">interfaces,</span> <span class="censored">because</span> <span class="censored">the</span> <span class="censored">following</span> <span class="censored">code</span> <span class="censored">is</span> <span class="censored">valid:</span></p> <div class="codeblock" id="code:19"> <figure class="highlight"><pre><code class="language-go" data-lang="go"><span class="k"><span class="censored">type</span></span> <span class="n"><span class="censored">A</span></span> <span class="k"><span class="censored">interface</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">Foo</span></span><span class="p"><span class="censored">()</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">var</span></span> <span class="p"><span class="censored">(</span></span>
  <span class="n"><span class="censored">a</span></span> <span class="n"><span class="censored">A</span></span>
  <span class="n"><span class="censored">b</span></span> <span class="k"><span class="censored">interface</span></span><span class="p"><span class="censored">{</span></span> <span class="n"><span class="censored">Foo</span></span><span class="p"><span class="censored">()</span></span> <span class="p"><span class="censored">}</span></span>
<span class="p"><span class="censored">)</span></span>

<span class="n"><span class="censored">a</span></span><span class="p"><span class="censored">,</span></span> <span class="n"><span class="censored">b</span></span> <span class="o"><span class="censored">=</span></span> <span class="n"><span class="censored">b</span></span><span class="p"><span class="censored">,</span></span> <span class="n"><span class="censored">a</span></span></code></pre></figure><div class="codeblock-buttons"><a class="codeblock-button codeblock-anchor" href="#code:19"><span class="censored">Go</span></a></div> </div> <p><span class="censored">Even</span> <span class="censored">though</span> <span class="censored">this</span> <span class="censored">fix</span> <span class="censored">seems</span> <span class="censored">really</span> <span class="censored">clean,</span> <span class="censored">it</span> <span class="censored">doesn’t</span> <span class="censored">work!</span> <span class="censored">The</span> <span class="censored">only</span> <span class="censored">way</span> <span class="censored">it</span> <span class="censored">could</span> <span class="censored">work</span> <span class="censored">is</span> <span class="censored">if</span> <span class="censored">PGO</span> <span class="censored">determines</span> <span class="censored">that</span> <span class="censored">a</span> <span class="censored">particular</span> <span class="censored">interface</span> <span class="censored">conversion</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code> <span class="censored">happens</span> <span class="censored">a</span> <span class="censored">lot,</span> <span class="censored">and</span> <span class="censored">updates</span> <span class="censored">the</span> <span class="censored">ABI</span> <span class="censored">of</span> <span class="censored">all</span> <span class="censored">interfaces</span> <span class="censored">with</span> <span class="censored">the</span> <span class="censored">method</span> <span class="censored">set</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">A</span></code><span class="censored">,</span> <span class="censored">program-globally,</span> <span class="censored">to</span> <span class="censored">contain</span> <span class="censored">a</span> <span class="censored">pointer</span> <span class="censored">to</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">B</span></code> <span class="censored">itab</span> <span class="censored">if</span> <span class="censored">available.</span></p> <h2 id="conclusion"><a href="#conclusion"><span class="censored">Conclusion</span></a></h2> <p><span class="censored">Go’s</span> <span class="censored">interfaces</span> <span class="censored">are</span> <span class="censored">pretty</span> <span class="censored">bad;</span> <span class="censored">in</span> <span class="censored">my</span> <span class="censored">opinion,</span> <span class="censored">a</span> <span class="censored">feature</span> <span class="censored">that</span> <span class="censored">looks</span> <span class="censored">good</span> <span class="censored">on</span> <span class="censored">a</span> <span class="censored">slide,</span> <span class="censored">but</span> <span class="censored">which</span> <span class="censored">results</span> <span class="censored">in</span> <span class="censored">a</span> <span class="censored">lot</span> <span class="censored">of</span> <span class="censored">mess</span> <span class="censored">due</span> <span class="censored">to</span> <span class="censored">its</span> <span class="censored">granular</span> <span class="censored">and</span> <span class="censored">intention-less</span> <span class="censored">nature.</span> <span class="censored">We</span> <span class="censored">can</span> <span class="censored">sort</span> <span class="censored">of</span> <span class="censored">patch</span> <span class="censored">over</span> <span class="censored">it</span> <span class="censored">with</span> <span class="censored">embeds,</span> <span class="censored">but</span> <span class="censored">there’s</span> <span class="censored">still</span> <span class="censored">problems.</span></p> <p><span class="censored">Due</span> <span class="censored">to</span> <span class="censored">how</span> <span class="censored">method</span> <span class="censored">sets</span> <span class="censored">work</span> <span class="censored">in</span> <span class="censored">Go,</span> <span class="censored">it’s</span> <span class="censored">very</span> <span class="censored">hard</span> <span class="censored">to</span> <span class="censored">“add”</span> <span class="censored">methods</span> <span class="censored">through</span> <span class="censored">an</span> <span class="censored">interface,</span> <span class="censored">and</span> <span class="censored">honestly</span> <span class="censored">at</span> <span class="censored">this</span> <span class="censored">point,</span> <span class="censored">any</span> <span class="censored">interface</span> <span class="censored">mechanism</span> <span class="censored">that</span> <span class="censored">makes</span> <span class="censored">it</span> <span class="censored">impossible</span> <span class="censored">(or</span> <span class="censored">expensive)</span> <span class="censored">to</span> <span class="censored">add</span> <span class="censored">new</span> <span class="censored">functions</span> <span class="censored">is</span> <span class="censored">going</span> <span class="censored">to</span> <span class="censored">be</span> <span class="censored">a</span> <span class="censored">huge</span> <span class="censored">problem.</span></p> <p><span class="censored">Missing</span> <span class="censored">methods</span> <span class="censored">seems</span> <span class="censored">like</span> <span class="censored">the</span> <span class="censored">best</span> <span class="censored">way</span> <span class="censored">out</span> <span class="censored">of</span> <span class="censored">this</span> <span class="censored">problem,</span> <span class="censored">but</span> <span class="censored">for</span> <span class="censored">now,</span> <span class="censored">we</span> <span class="censored">can</span> <span class="censored">stick</span> <span class="censored">to</span> <span class="censored">the</span> <span class="censored">janky</span> <span class="censored">embedded</span> <span class="censored">structs.</span></p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:satisfy-implement" role="doc-endnote"> <p><span class="censored">Go</span> <span class="censored">uses</span> <span class="censored">the</span> <span class="censored">term</span> <span class="censored">“implements”</span> <span class="censored">to</span> <span class="censored">say</span> <span class="censored">that</span> <span class="censored">a</span> <span class="censored">type</span> <span class="censored">satisfies</span> <span class="censored">an</span> <span class="censored">interface.</span> <span class="censored">I</span> <span class="censored">am</span> <span class="censored">instead</span> <span class="censored">intentionally</span> <span class="censored">using</span> <span class="censored">the</span> <span class="censored">term</span> <span class="censored">“satisfies”,</span> <span class="censored">because</span> <span class="censored">it</span> <span class="censored">makes</span> <span class="censored">the</span> <span class="censored">structural,</span> <span class="censored">passive</span> <span class="censored">nature</span> <span class="censored">of</span> <span class="censored">implementing</span> <span class="censored">an</span> <span class="censored">interface</span> <span class="censored">clearer.</span> <span class="censored">This</span> <span class="censored">is</span> <span class="censored">also</span> <span class="censored">more</span> <span class="censored">in-line</span> <span class="censored">with</span> <span class="censored">interfaces’</span> <span class="censored">use</span> <span class="censored">as</span> <span class="censored">generic</span> <span class="censored">constraints.</span></p> <p><span class="censored">Swift</span> <span class="censored">uses</span> <span class="censored">the</span> <span class="censored">term</span> <span class="censored">“conform”</span> <span class="censored">instead,</span> <span class="censored">which</span> <span class="censored">I</span> <span class="censored">am</span> <span class="censored">avoiding</span> <span class="censored">for</span> <span class="censored">this</span> <span class="censored">reason. </span><a href="#fnref:satisfy-implement" class="reversefootnote" role="doc-backlink"><span class="censored">↩</span></a></p> </li> </ol> </div> </div> <div class="related post-footer"> <h2> <span class="censored">Related</span> <span class="censored">Posts</span> </h2> <ul class="related-posts"> <li> <span class="post-meta"><span class="censored">2025-10-30</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/10/30/living-room-2/"><span class="censored">Living</span> <span class="censored">Room</span> <span class="censored">2</span></a></h6> </li> <li> <span class="post-meta"><span class="censored">2025-10-28</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/10/28/boombox-boobs/"><span class="censored">Boombox</span> <span class="censored">Boobs</span></a></h6> </li> <li> <span class="post-meta"><span class="censored">2025-10-27</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/10/27/living-room/"><span class="censored">Living</span> <span class="censored">Room</span></a></h6> </li> </ul> </div> </div> </div> </div></div> <div class="sidebar show-if-mobile footer"> <div class="container sidebar-sticky"> &copy; 2025 Miguel Young de la Sota <br> <div style="font-size: 95%;"> <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC BY-SA</a> • <a href="https://varz.mcyoung.xyz/">Site Analytics</a> </div> </div> </div> </body> </html>