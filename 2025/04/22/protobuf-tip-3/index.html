<!DOCTYPE html> <html lang="en-us"> <head> <link href="https://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Protobuf Tip #3: Enum Names Need Prefixes &middot; mcyoung </title> <script async src="https://mcyoung.xyz/public/js/redirect.js"></script> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/syntax.css"> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/syntax-overrides.css"> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/style.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"> <link rel="preload" href="https://mcyoung.xyz/public/fonts/abril-fatface.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/rokkitt.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/rokkitt-italic.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/spline-mono.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/spline-mono-italic.woff2" as="font" type="font/woff2" crossorigin> <link rel="shortcut icon" href="https://mcyoung.xyz/public/favicon.ico"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <script src="https://mcyoung.xyz/public/js/minimap.js"></script> <script data-goatcounter="https://mcy.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:title" content="Protobuf Tip #3: Enum Names Need Prefixes &middot; mcyoung"> <meta name="twitter:image" content="https://mcyoung.xyz/og/protobuf-tip-3-95103a2dd6e49da5f9223f6fb6e2dacb274a49ab.png"> <meta property="og:title" content="Protobuf Tip #3: Enum Names Need Prefixes &middot; mcyoung"> <meta property="og:type" content="object"> <meta property="og:image" content="https://mcyoung.xyz/og/protobuf-tip-3-95103a2dd6e49da5f9223f6fb6e2dacb274a49ab.png"> <meta property="og:height" content="630"> <meta property="og:width" content="1200"> <meta property="og:url" content="https://mcyoung.xyz/2025/04/22/protobuf-tip-3/"> <link rel="canonical" href="https://buf.build/blog/totw-3-enum-names-need-prefixes"> </head> <body> <div class="sidebar"> <div class="sidebar-avatar hide-if-mobile"> <a href="https://mcyoung.xyz"> <img class="sidebar-avatar" src="https://mcyoung.xyz/public/images/avatar.png" alt="Yeah, I drew this. Check out my art blog."></a> </div> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1><a href="https://mcyoung.xyz"> mcyoung </a></h1> <div class="lead hide-if-mobile">I'm Miguel. I write about compilers, performance, and silly computer things. I also draw Pokémon. </div> </div> <hr class="hide-if-mobile"/> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="https://mcyoung.xyz">Home</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/about">About</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/posts">Posts</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/tags">Tags</a> </nav> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="https://github.com/mcy"> <img src="https://mcyoung.xyz/public/images/github.svg"></a> • <a class="sidebar-nav-item" href="https://bsky.app/profile/mcy.gay"> <img style="height: 0.75em;" src="https://mcyoung.xyz/public/images/bsky.svg"></a> • <a class="sidebar-nav-item " href="https://art.mcyoung.xyz">Art</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/resume">Resumé</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/syllabus">Syllabus</a> </nav> <br class="hide-if-mobile"/> <span class="hide-if-mobile"> <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC BY-SA</a> • <a href="https://varz.mcyoung.xyz/">Site Analytics</a> <br> &copy; 2025 Miguel Young de la Sota</span> </div> </div> <div class="content container"><div class="post-title"> <span class="post-meta"> 2025-04-22 • 725 words • 6 minutes <br class="show-if-mobile"/> <span class="hide-if-mobile">•</span> <a href="https://mcyoung.xyz/tags.html#protobuf-tips">#protobuf-tips</a> </span> <h1><a href="/2025/04/22/protobuf-tip-3/"> Protobuf Tip #3: Enum Names Need Prefixes </a></h1> </div> <div class="post"> <p><em>Smart people learn from their mistakes. But the real sharp ones learn from the mistakes of others. –Brandon Mull</em></p> <p>TL;DR: <code class="language-plaintext highlighter-rouge">enum</code>s inherit some unfortunate behaviors from C++. Use the Buf lint rules <a href="https://buf.build/docs/lint/rules/#enum_value_prefix"><code class="language-plaintext highlighter-rouge">ENUM_VALUE_PREFIX</code></a> and <a href="https://buf.build/docs/lint/rules/#enum_zero_value_suffix"><code class="language-plaintext highlighter-rouge">ENUM_ZERO_VALUE_SUFFIX</code></a>  to avoid this problem (they’re part of the <code class="language-plaintext highlighter-rouge">DEFAULT</code> category).</p> <blockquote> <p>I’m editing a series of best practice pieces on Protobuf, a language that I work on which has lots of evil corner-cases.These are shorter than what I typically post here, but I think it fits with what you, dear reader, come to this blog for. These tips are also posted on the <a href="https://buf.build/blog/totw-3-enum-names-need-prefixes">buf.build blog</a>.</p> </blockquote> <h2 id="c-style-enums"><a href="#c-style-enums">C++-Style Enums</a></h2> <p>Protobuf’s <code class="language-plaintext highlighter-rouge">enum</code>s define data types that represent a small set of valid values. For example, <code class="language-plaintext highlighter-rouge">google.rpc.Code</code> lists status codes used by various RPC frameworks, such as GRPC. Under the hood, every <code class="language-plaintext highlighter-rouge">enum</code> is just an <code class="language-plaintext highlighter-rouge">int32</code>  on the wire, although codegen backends will generate custom types and constants for the enum to make it easier to use.</p> <p>Unfortunately, <code class="language-plaintext highlighter-rouge">enum</code>s were originally designed to match C++ enums exactly, and they inadvertently replicate many of those behaviors.</p> <p>If you look at the source for <code class="language-plaintext highlighter-rouge">google.rpc.Code</code>, and compare it to, say, <code class="language-plaintext highlighter-rouge">google.protobuf.FieldDescriptorProto.Type</code>, you will notice a subtle difference:</p> <div class="codeblock"><figure class="highlight"><pre><code class="language-protobuf" data-lang="protobuf"><span class="kn">package</span> <span class="nn">google</span><span class="o">.</span><span class="k">rpc</span><span class="p">;</span>
<span class="kd">enum</span> <span class="n">Code</span> <span class="p">{</span>
  <span class="na">OK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">CANCELLED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="na">UNKNOWN</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kn">package</span> <span class="nn">google</span><span class="o">.</span><span class="n">protobuf</span><span class="p">;</span>
<span class="kd">message</span> <span class="nc">FieldDescriptorProto</span> <span class="p">{</span>
  <span class="kd">enum</span> <span class="n">Type</span> <span class="p">{</span>
    <span class="c1">// 0 is reserved for errors.</span>
    <span class="na">TYPE_DOUBLE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="na">TYPE_FLOAT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="na">TYPE_INT64</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button">Protobuf</div></div></div> <p><code class="language-plaintext highlighter-rouge">FieldDescriptorProto.Type</code> has values starting with <code class="language-plaintext highlighter-rouge">TYPE_</code>, but <code class="language-plaintext highlighter-rouge">Code</code> ‘s values don’t have a <code class="language-plaintext highlighter-rouge">CODE_</code> prefix.  This is because the fully-qualified names (FQN) of an enum value <em>don’t include the name of the enum.</em> That is, <code class="language-plaintext highlighter-rouge">TYPE_DOUBLE</code> actually refers to <code class="language-plaintext highlighter-rouge">google.protobuf.FieldDescriptorProto.TYPE_DOUBLE</code>. Thus, <code class="language-plaintext highlighter-rouge">OK</code> is not <code class="language-plaintext highlighter-rouge">google.rpc.Code.OK</code>, but <code class="language-plaintext highlighter-rouge">google.rpc.OK</code>.</p> <p>This is because it matches the behavior of unscoped C++ enums. C++ is the “reference” implementation, so the language often bends for the sake of the C++ backend.</p> <p>When generating code, <code class="language-plaintext highlighter-rouge">protoc</code>’s C++ backend emits the above as follows:</p> <div class="codeblock"><figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">namespace</span> <span class="n">google</span><span class="o">::</span><span class="n">rpc</span> <span class="p">{</span>
<span class="k">enum</span> <span class="n">Code</span> <span class="p">{</span>
  <span class="n">OK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
  <span class="n">CANCELLED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
  <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
  <span class="c1">// ...</span>
<span class="p">};</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="n">google</span><span class="o">::</span><span class="n">protobuf</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">FieldDescriptorProto</span> <span class="k">final</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="k">enum</span> <span class="n">Type</span> <span class="p">{</span>
   <span class="n">TYPE_DOUBLE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="n">TYPE_FLOAT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
   <span class="c1">// ...</span>
  <span class="p">};</span>
<span class="p">};</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button">C++</div></div></div> <p>And in C++, <code class="language-plaintext highlighter-rouge">enum</code>s don’t scope their enumerators: you write <code class="language-plaintext highlighter-rouge">google::rpc::OK</code>, NOT <code class="language-plaintext highlighter-rouge">google::rpc::Code::OK</code>.</p> <p>If you know C++, you might be thinking, “why didn’t they use <code class="language-plaintext highlighter-rouge">enum class</code>?!”? Enums were added in <code class="language-plaintext highlighter-rouge">proto2</code>, which was developed around 2007-2008, but Google didn’t start using C++11, which introduced <code class="language-plaintext highlighter-rouge">enum class</code> , until much, much later.</p> <p>Now, if you’re a Go or Java programmer, you’re probably wondering why you even care about C++. Both Go and Java do scope enum values to the enum type (although Go does it in a somewhat grody way: <code class="language-plaintext highlighter-rouge">rpcpb.Code_OK</code>).</p> <p>Unfortunately, this affects name collision detection in Protobuf. You can’t write the following code:</p> <div class="codeblock"><figure class="highlight"><pre><code class="language-protobuf" data-lang="protobuf"><span class="kn">package</span> <span class="nn">myapi</span><span class="o">.</span><span class="n">v1</span><span class="p">;</span>

<span class="kd">enum</span> <span class="n">Stoplight</span> <span class="p">{</span>
  <span class="na">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">RED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="na">YELLOW</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="na">GREEN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="n">Speed</span> <span class="p">{</span>
  <span class="na">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">SLOW</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="na">FAST</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button">Protobuf</div></div></div> <p>Because the enum name is not part of the FQN for an enum value, both <code class="language-plaintext highlighter-rouge">UNSPECIFIED</code>s here have the FQN <code class="language-plaintext highlighter-rouge">myapi.v1.UNSPECIFIED</code>, so Protobuf complains about duplicate symbols.</p> <p>Thus, the convention we see in <code class="language-plaintext highlighter-rouge">FieldDescriptorProto.Type</code>:</p> <div class="codeblock"><figure class="highlight"><pre><code class="language-protobuf" data-lang="protobuf"><span class="kn">package</span> <span class="nn">myapi</span><span class="o">.</span><span class="n">v1</span><span class="p">;</span>

<span class="kd">enum</span> <span class="n">Stoplight</span> <span class="p">{</span>
  <span class="na">STOPLIGHT_UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">STOPLIGHT_RED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="na">STOPLIGHT_YELLOW</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="na">STOPLIGHT_GREEN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="n">Speed</span> <span class="p">{</span>
  <span class="na">SPEED_UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">SPEED_SLOW</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="na">SPEED_FAST</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button">Protobuf</div></div></div> <p>Buf provides a lint rule to enforce this convention: <a href="https://buf.build/docs/lint/rules/#enum_value_prefix"><code class="language-plaintext highlighter-rouge">ENUM_VALUE_PREFIX</code></a>. Even though you might think that an enum name will be unique, because top-level enums bleed their names into the containing package, the problem spreads across packages!</p> <h2 id="zero-values"><a href="#zero-values">Zero Values</a></h2> <p><code class="language-plaintext highlighter-rouge">proto3</code> relies heavily on the concept of “zero values” – all non-message fields that are neither <code class="language-plaintext highlighter-rouge">repeated</code> nor <code class="language-plaintext highlighter-rouge">optional</code> are implicitly zero if they are not present. Thus, <code class="language-plaintext highlighter-rouge">proto3</code> requires that enums specify a value equal to zero.</p> <p>By convention, this value shouldn’t be a specific value of the enum, but rather a value representing that no value is specified. <a href="https://buf.build/docs/lint/rules/#enum_zero_value_suffix"><code class="language-plaintext highlighter-rouge">ENUM_ZERO_VALUE_SUFFIX</code></a> enforces this, with a default of <code class="language-plaintext highlighter-rouge">_UNSPECIFIED</code>. Of course, there are situations where this might not make sense for you, and a suffix like <code class="language-plaintext highlighter-rouge">_ZERO</code> or <code class="language-plaintext highlighter-rouge">_UNKNOWN</code> might make more sense.</p> <p>It may be tempting to have a specific “good default” value for the zero value. Beware though, because that choice is forever. Picking a generic “unknown” as the default reduces the chance you’ll burn yourself.</p> <h2 id="why-dont-all-of-googles-protobuf-files-do-this"><a href="#why-dont-all-of-googles-protobuf-files-do-this">Why Don’t All of Google’s Protobuf Files Do This?</a></h2> <p>Name prefixes and zero values also teach us an important lesson: because Protobuf names are forever, it’s really hard to fix style mistakes, especially as we collectively get better at using Protobuf.</p> <p><code class="language-plaintext highlighter-rouge">google.rpc.Code</code> is intended to be source-compatible with very old existing C++ code, so it throws caution to the wind. <code class="language-plaintext highlighter-rouge">FieldDescriptorProto.Type</code> doesn’t have a zero value because in <code class="language-plaintext highlighter-rouge">proto2</code> , which doesn’t have zero value footguns in its wire format, you don’t need to worry about that. The lesson isn’t just to use Buf’s linter to try to avoid some of the known pitfalls, but also to remember that even APIs designed by the authors of the language make unfixable mistakes, so unlike other programming languages, imitating “existing practice” isn’t always the best strategy.</p> </div> <div class="related post-footer"> <h2>Related Posts</h2> <ul class="related-posts"> <li> <span class="post-meta">2025-06-03</span> / <h6 style="display:inline"><a href="/2025/06/03/protobuf-tip-7/">Protobuf Tip #7: Scoping It Out</a></h6> <li> <span class="post-meta">2025-05-20</span> / <h6 style="display:inline"><a href="/2025/05/20/protobuf-tip-6/">Protobuf Tip #6: The Subtle Dangers of Enum Aliases</a></h6> <li> <span class="post-meta">2025-05-13</span> / <h6 style="display:inline"><a href="/2025/05/13/protobuf-tip-5/">Protobuf Tip #5: Avoid import public/weak</a></h6> </ul> </div> <div class="minimap" aria-hidden="true"> <div class="minimap-size"></div> <div class="minimap-controller"></div> <div class="minimap-content"> <div class="content container"> <div class="post-title"> <span class="post-meta"> <span class="censored">2025-04-22</span> <span class="censored">•</span> <span class="censored">725</span> <span class="censored">words</span> <span class="censored">•</span> <span class="censored">6</span> <span class="censored">minutes</span> <br class="show-if-mobile"> <span class="hide-if-mobile"><span class="censored">•</span></span> <a href="https://mcyoung.xyz/tags.html#protobuf-tips"><span class="censored">#protobuf-tips</span></a> </span> <h1><a href="/2025/04/22/protobuf-tip-3/"> <span class="censored">Protobuf</span> <span class="censored">Tip</span> <span class="censored">#3:</span> <span class="censored">Enum</span> <span class="censored">Names</span> <span class="censored">Need</span> <span class="censored">Prefixes</span> </a></h1> </div> <div class="post"> <p><em><span class="censored">Smart</span> <span class="censored">people</span> <span class="censored">learn</span> <span class="censored">from</span> <span class="censored">their</span> <span class="censored">mistakes.</span> <span class="censored">But</span> <span class="censored">the</span> <span class="censored">real</span> <span class="censored">sharp</span> <span class="censored">ones</span> <span class="censored">learn</span> <span class="censored">from</span> <span class="censored">the</span> <span class="censored">mistakes</span> <span class="censored">of</span> <span class="censored">others.</span> <span class="censored">–Brandon</span> <span class="censored">Mull</span></em></p> <p><span class="censored">TL;DR:</span> <code class="language-plaintext highlighter-rouge"><span class="censored">enum</span></code><span class="censored">s</span> <span class="censored">inherit</span> <span class="censored">some</span> <span class="censored">unfortunate</span> <span class="censored">behaviors</span> <span class="censored">from</span> <span class="censored">C++.</span> <span class="censored">Use</span> <span class="censored">the</span> <span class="censored">Buf</span> <span class="censored">lint</span> <span class="censored">rules</span> <a href="https://buf.build/docs/lint/rules/#enum_value_prefix"><code class="language-plaintext highlighter-rouge"><span class="censored">ENUM_VALUE_PREFIX</span></code></a> <span class="censored">and</span> <a href="https://buf.build/docs/lint/rules/#enum_zero_value_suffix"><code class="language-plaintext highlighter-rouge"><span class="censored">ENUM_ZERO_VALUE_SUFFIX</span></code></a> <span class="censored"> to</span> <span class="censored">avoid</span> <span class="censored">this</span> <span class="censored">problem</span> <span class="censored">(they’re</span> <span class="censored">part</span> <span class="censored">of</span> <span class="censored">the</span> <code class="language-plaintext highlighter-rouge"><span class="censored">DEFAULT</span></code> <span class="censored">category).</span></p> <blockquote> <p><span class="censored">I’m</span> <span class="censored">editing</span> <span class="censored">a</span> <span class="censored">series</span> <span class="censored">of</span> <span class="censored">best</span> <span class="censored">practice</span> <span class="censored">pieces</span> <span class="censored">on</span> <span class="censored">Protobuf,</span> <span class="censored">a</span> <span class="censored">language</span> <span class="censored">that</span> <span class="censored">I</span> <span class="censored">work</span> <span class="censored">on</span> <span class="censored">which</span> <span class="censored">has</span> <span class="censored">lots</span> <span class="censored">of</span> <span class="censored">evil</span> <span class="censored">corner-cases.These</span> <span class="censored">are</span> <span class="censored">shorter</span> <span class="censored">than</span> <span class="censored">what</span> <span class="censored">I</span> <span class="censored">typically</span> <span class="censored">post</span> <span class="censored">here,</span> <span class="censored">but</span> <span class="censored">I</span> <span class="censored">think</span> <span class="censored">it</span> <span class="censored">fits</span> <span class="censored">with</span> <span class="censored">what</span> <span class="censored">you,</span> <span class="censored">dear</span> <span class="censored">reader,</span> <span class="censored">come</span> <span class="censored">to</span> <span class="censored">this</span> <span class="censored">blog</span> <span class="censored">for.</span> <span class="censored">These</span> <span class="censored">tips</span> <span class="censored">are</span> <span class="censored">also</span> <span class="censored">posted</span> <span class="censored">on</span> <span class="censored">the</span> <a href="https://buf.build/blog/totw-3-enum-names-need-prefixes"><span class="censored">buf.build</span> <span class="censored">blog</span></a><span class="censored">.</span></p> </blockquote> <h2 id="c-style-enums"><a href="#c-style-enums"><span class="censored">C++-Style</span> <span class="censored">Enums</span></a></h2> <p><span class="censored">Protobuf’s</span> <code class="language-plaintext highlighter-rouge"><span class="censored">enum</span></code><span class="censored">s</span> <span class="censored">define</span> <span class="censored">data</span> <span class="censored">types</span> <span class="censored">that</span> <span class="censored">represent</span> <span class="censored">a</span> <span class="censored">small</span> <span class="censored">set</span> <span class="censored">of</span> <span class="censored">valid</span> <span class="censored">values.</span> <span class="censored">For</span> <span class="censored">example,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google.rpc.Code</span></code> <span class="censored">lists</span> <span class="censored">status</span> <span class="censored">codes</span> <span class="censored">used</span> <span class="censored">by</span> <span class="censored">various</span> <span class="censored">RPC</span> <span class="censored">frameworks,</span> <span class="censored">such</span> <span class="censored">as</span> <span class="censored">GRPC.</span> <span class="censored">Under</span> <span class="censored">the</span> <span class="censored">hood,</span> <span class="censored">every</span> <code class="language-plaintext highlighter-rouge"><span class="censored">enum</span></code> <span class="censored">is</span> <span class="censored">just</span> <span class="censored">an</span> <code class="language-plaintext highlighter-rouge"><span class="censored">int32</span></code> <span class="censored"> on</span> <span class="censored">the</span> <span class="censored">wire,</span> <span class="censored">although</span> <span class="censored">codegen</span> <span class="censored">backends</span> <span class="censored">will</span> <span class="censored">generate</span> <span class="censored">custom</span> <span class="censored">types</span> <span class="censored">and</span> <span class="censored">constants</span> <span class="censored">for</span> <span class="censored">the</span> <span class="censored">enum</span> <span class="censored">to</span> <span class="censored">make</span> <span class="censored">it</span> <span class="censored">easier</span> <span class="censored">to</span> <span class="censored">use.</span></p> <p><span class="censored">Unfortunately,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">enum</span></code><span class="censored">s</span> <span class="censored">were</span> <span class="censored">originally</span> <span class="censored">designed</span> <span class="censored">to</span> <span class="censored">match</span> <span class="censored">C++</span> <span class="censored">enums</span> <span class="censored">exactly,</span> <span class="censored">and</span> <span class="censored">they</span> <span class="censored">inadvertently</span> <span class="censored">replicate</span> <span class="censored">many</span> <span class="censored">of</span> <span class="censored">those</span> <span class="censored">behaviors.</span></p> <p><span class="censored">If</span> <span class="censored">you</span> <span class="censored">look</span> <span class="censored">at</span> <span class="censored">the</span> <span class="censored">source</span> <span class="censored">for</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google.rpc.Code</span></code><span class="censored">,</span> <span class="censored">and</span> <span class="censored">compare</span> <span class="censored">it</span> <span class="censored">to,</span> <span class="censored">say,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google.protobuf.FieldDescriptorProto.Type</span></code><span class="censored">,</span> <span class="censored">you</span> <span class="censored">will</span> <span class="censored">notice</span> <span class="censored">a</span> <span class="censored">subtle</span> <span class="censored">difference:</span></p> <div class="codeblock"> <figure class="highlight"><pre><code class="language-protobuf" data-lang="protobuf"><span class="kn"><span class="censored">package</span></span> <span class="nn"><span class="censored">google</span></span><span class="o"><span class="censored">.</span></span><span class="k"><span class="censored">rpc</span></span><span class="p"><span class="censored">;</span></span>
<span class="kd"><span class="censored">enum</span></span> <span class="n"><span class="censored">Code</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="na"><span class="censored">OK</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">0</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">CANCELLED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">UNKNOWN</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">;</span></span>
  <span class="c1"><span class="censored">//</span> <span class="censored">...</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="kn"><span class="censored">package</span></span> <span class="nn"><span class="censored">google</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">protobuf</span></span><span class="p"><span class="censored">;</span></span>
<span class="kd"><span class="censored">message</span></span> <span class="nc"><span class="censored">FieldDescriptorProto</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="kd"><span class="censored">enum</span></span> <span class="n"><span class="censored">Type</span></span> <span class="p"><span class="censored">{</span></span>
    <span class="c1"><span class="censored">//</span> <span class="censored">0</span> <span class="censored">is</span> <span class="censored">reserved</span> <span class="censored">for</span> <span class="censored">errors.</span></span>
    <span class="na"><span class="censored">TYPE_DOUBLE</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">;</span></span>
    <span class="na"><span class="censored">TYPE_FLOAT</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">;</span></span>
    <span class="na"><span class="censored">TYPE_INT64</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">3</span></span><span class="p"><span class="censored">;</span></span>
    <span class="c1"><span class="censored">//</span> <span class="censored">...</span></span>
  <span class="p"><span class="censored">}</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button"><span class="censored">Protobuf</span></div></div> </div> <p><code class="language-plaintext highlighter-rouge"><span class="censored">FieldDescriptorProto.Type</span></code> <span class="censored">has</span> <span class="censored">values</span> <span class="censored">starting</span> <span class="censored">with</span> <code class="language-plaintext highlighter-rouge"><span class="censored">TYPE_</span></code><span class="censored">,</span> <span class="censored">but</span> <code class="language-plaintext highlighter-rouge"><span class="censored">Code</span></code> <span class="censored">‘s</span> <span class="censored">values</span> <span class="censored">don’t</span> <span class="censored">have</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">CODE_</span></code> <span class="censored">prefix.</span> <span class="censored"> This</span> <span class="censored">is</span> <span class="censored">because</span> <span class="censored">the</span> <span class="censored">fully-qualified</span> <span class="censored">names</span> <span class="censored">(FQN)</span> <span class="censored">of</span> <span class="censored">an</span> <span class="censored">enum</span> <span class="censored">value</span> <em><span class="censored">don’t</span> <span class="censored">include</span> <span class="censored">the</span> <span class="censored">name</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">enum.</span></em> <span class="censored">That</span> <span class="censored">is,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">TYPE_DOUBLE</span></code> <span class="censored">actually</span> <span class="censored">refers</span> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google.protobuf.FieldDescriptorProto.TYPE_DOUBLE</span></code><span class="censored">.</span> <span class="censored">Thus,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">OK</span></code> <span class="censored">is</span> <span class="censored">not</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google.rpc.Code.OK</span></code><span class="censored">,</span> <span class="censored">but</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google.rpc.OK</span></code><span class="censored">.</span></p> <p><span class="censored">This</span> <span class="censored">is</span> <span class="censored">because</span> <span class="censored">it</span> <span class="censored">matches</span> <span class="censored">the</span> <span class="censored">behavior</span> <span class="censored">of</span> <span class="censored">unscoped</span> <span class="censored">C++</span> <span class="censored">enums.</span> <span class="censored">C++</span> <span class="censored">is</span> <span class="censored">the</span> <span class="censored">“reference”</span> <span class="censored">implementation,</span> <span class="censored">so</span> <span class="censored">the</span> <span class="censored">language</span> <span class="censored">often</span> <span class="censored">bends</span> <span class="censored">for</span> <span class="censored">the</span> <span class="censored">sake</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">C++</span> <span class="censored">backend.</span></p> <p><span class="censored">When</span> <span class="censored">generating</span> <span class="censored">code,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">protoc</span></code><span class="censored">’s</span> <span class="censored">C++</span> <span class="censored">backend</span> <span class="censored">emits</span> <span class="censored">the</span> <span class="censored">above</span> <span class="censored">as</span> <span class="censored">follows:</span></p> <div class="codeblock"> <figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k"><span class="censored">namespace</span></span> <span class="n"><span class="censored">google</span></span><span class="o"><span class="censored">::</span></span><span class="n"><span class="censored">rpc</span></span> <span class="p"><span class="censored">{</span></span>
<span class="k"><span class="censored">enum</span></span> <span class="n"><span class="censored">Code</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="n"><span class="censored">OK</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">0</span></span><span class="p"><span class="censored">,</span></span>
  <span class="n"><span class="censored">CANCELLED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">,</span></span>
  <span class="n"><span class="censored">UNSPECIFIED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">,</span></span>
  <span class="c1"><span class="censored">//</span> <span class="censored">...</span></span>
<span class="p"><span class="censored">};</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="k"><span class="censored">namespace</span></span> <span class="n"><span class="censored">google</span></span><span class="o"><span class="censored">::</span></span><span class="n"><span class="censored">protobuf</span></span> <span class="p"><span class="censored">{</span></span>
<span class="k"><span class="censored">class</span></span> <span class="nc"><span class="censored">FieldDescriptorProto</span></span> <span class="k"><span class="censored">final</span></span> <span class="p"><span class="censored">{</span></span>
 <span class="nl"><span class="censored">public:</span></span>
  <span class="k"><span class="censored">enum</span></span> <span class="n"><span class="censored">Type</span></span> <span class="p"><span class="censored">{</span></span>
   <span class="n"><span class="censored">TYPE_DOUBLE</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">;</span></span>
   <span class="n"><span class="censored">TYPE_FLOAT</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">;</span></span>
   <span class="c1"><span class="censored">//</span> <span class="censored">...</span></span>
  <span class="p"><span class="censored">};</span></span>
<span class="p"><span class="censored">};</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button"><span class="censored">C++</span></div></div> </div> <p><span class="censored">And</span> <span class="censored">in</span> <span class="censored">C++,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">enum</span></code><span class="censored">s</span> <span class="censored">don’t</span> <span class="censored">scope</span> <span class="censored">their</span> <span class="censored">enumerators:</span> <span class="censored">you</span> <span class="censored">write</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google::rpc::OK</span></code><span class="censored">,</span> <span class="censored">NOT</span> <code class="language-plaintext highlighter-rouge"><span class="censored">google::rpc::Code::OK</span></code><span class="censored">.</span></p> <p><span class="censored">If</span> <span class="censored">you</span> <span class="censored">know</span> <span class="censored">C++,</span> <span class="censored">you</span> <span class="censored">might</span> <span class="censored">be</span> <span class="censored">thinking,</span> <span class="censored">“why</span> <span class="censored">didn’t</span> <span class="censored">they</span> <span class="censored">use</span> <code class="language-plaintext highlighter-rouge"><span class="censored">enum</span> <span class="censored">class</span></code><span class="censored">?!”?</span> <span class="censored">Enums</span> <span class="censored">were</span> <span class="censored">added</span> <span class="censored">in</span> <code class="language-plaintext highlighter-rouge"><span class="censored">proto2</span></code><span class="censored">,</span> <span class="censored">which</span> <span class="censored">was</span> <span class="censored">developed</span> <span class="censored">around</span> <span class="censored">2007-2008,</span> <span class="censored">but</span> <span class="censored">Google</span> <span class="censored">didn’t</span> <span class="censored">start</span> <span class="censored">using</span> <span class="censored">C++11,</span> <span class="censored">which</span> <span class="censored">introduced</span> <code class="language-plaintext highlighter-rouge"><span class="censored">enum</span> <span class="censored">class</span></code> <span class="censored">,</span> <span class="censored">until</span> <span class="censored">much,</span> <span class="censored">much</span> <span class="censored">later.</span></p> <p><span class="censored">Now,</span> <span class="censored">if</span> <span class="censored">you’re</span> <span class="censored">a</span> <span class="censored">Go</span> <span class="censored">or</span> <span class="censored">Java</span> <span class="censored">programmer,</span> <span class="censored">you’re</span> <span class="censored">probably</span> <span class="censored">wondering</span> <span class="censored">why</span> <span class="censored">you</span> <span class="censored">even</span> <span class="censored">care</span> <span class="censored">about</span> <span class="censored">C++.</span> <span class="censored">Both</span> <span class="censored">Go</span> <span class="censored">and</span> <span class="censored">Java</span> <span class="censored">do</span> <span class="censored">scope</span> <span class="censored">enum</span> <span class="censored">values</span> <span class="censored">to</span> <span class="censored">the</span> <span class="censored">enum</span> <span class="censored">type</span> <span class="censored">(although</span> <span class="censored">Go</span> <span class="censored">does</span> <span class="censored">it</span> <span class="censored">in</span> <span class="censored">a</span> <span class="censored">somewhat</span> <span class="censored">grody</span> <span class="censored">way:</span> <code class="language-plaintext highlighter-rouge"><span class="censored">rpcpb.Code_OK</span></code><span class="censored">).</span></p> <p><span class="censored">Unfortunately,</span> <span class="censored">this</span> <span class="censored">affects</span> <span class="censored">name</span> <span class="censored">collision</span> <span class="censored">detection</span> <span class="censored">in</span> <span class="censored">Protobuf.</span> <span class="censored">You</span> <span class="censored">can’t</span> <span class="censored">write</span> <span class="censored">the</span> <span class="censored">following</span> <span class="censored">code:</span></p> <div class="codeblock"> <figure class="highlight"><pre><code class="language-protobuf" data-lang="protobuf"><span class="kn"><span class="censored">package</span></span> <span class="nn"><span class="censored">myapi</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">v1</span></span><span class="p"><span class="censored">;</span></span>

<span class="kd"><span class="censored">enum</span></span> <span class="n"><span class="censored">Stoplight</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="na"><span class="censored">UNSPECIFIED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">0</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">RED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">YELLOW</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">GREEN</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">3</span></span><span class="p"><span class="censored">;</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="kd"><span class="censored">enum</span></span> <span class="n"><span class="censored">Speed</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="na"><span class="censored">UNSPECIFIED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">0</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">SLOW</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">FAST</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">;</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button"><span class="censored">Protobuf</span></div></div> </div> <p><span class="censored">Because</span> <span class="censored">the</span> <span class="censored">enum</span> <span class="censored">name</span> <span class="censored">is</span> <span class="censored">not</span> <span class="censored">part</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">FQN</span> <span class="censored">for</span> <span class="censored">an</span> <span class="censored">enum</span> <span class="censored">value,</span> <span class="censored">both</span> <code class="language-plaintext highlighter-rouge"><span class="censored">UNSPECIFIED</span></code><span class="censored">s</span> <span class="censored">here</span> <span class="censored">have</span> <span class="censored">the</span> <span class="censored">FQN</span> <code class="language-plaintext highlighter-rouge"><span class="censored">myapi.v1.UNSPECIFIED</span></code><span class="censored">,</span> <span class="censored">so</span> <span class="censored">Protobuf</span> <span class="censored">complains</span> <span class="censored">about</span> <span class="censored">duplicate</span> <span class="censored">symbols.</span></p> <p><span class="censored">Thus,</span> <span class="censored">the</span> <span class="censored">convention</span> <span class="censored">we</span> <span class="censored">see</span> <span class="censored">in</span> <code class="language-plaintext highlighter-rouge"><span class="censored">FieldDescriptorProto.Type</span></code><span class="censored">:</span></p> <div class="codeblock"> <figure class="highlight"><pre><code class="language-protobuf" data-lang="protobuf"><span class="kn"><span class="censored">package</span></span> <span class="nn"><span class="censored">myapi</span></span><span class="o"><span class="censored">.</span></span><span class="n"><span class="censored">v1</span></span><span class="p"><span class="censored">;</span></span>

<span class="kd"><span class="censored">enum</span></span> <span class="n"><span class="censored">Stoplight</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="na"><span class="censored">STOPLIGHT_UNSPECIFIED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">0</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">STOPLIGHT_RED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">STOPLIGHT_YELLOW</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">STOPLIGHT_GREEN</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">3</span></span><span class="p"><span class="censored">;</span></span>
<span class="p"><span class="censored">}</span></span>

<span class="kd"><span class="censored">enum</span></span> <span class="n"><span class="censored">Speed</span></span> <span class="p"><span class="censored">{</span></span>
  <span class="na"><span class="censored">SPEED_UNSPECIFIED</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">0</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">SPEED_SLOW</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">1</span></span><span class="p"><span class="censored">;</span></span>
  <span class="na"><span class="censored">SPEED_FAST</span></span> <span class="o"><span class="censored">=</span></span> <span class="mi"><span class="censored">2</span></span><span class="p"><span class="censored">;</span></span>
<span class="p"><span class="censored">}</span></span></code></pre></figure><div class="codeblock-buttons"><div class="codeblock-button"><span class="censored">Protobuf</span></div></div> </div> <p><span class="censored">Buf</span> <span class="censored">provides</span> <span class="censored">a</span> <span class="censored">lint</span> <span class="censored">rule</span> <span class="censored">to</span> <span class="censored">enforce</span> <span class="censored">this</span> <span class="censored">convention:</span> <a href="https://buf.build/docs/lint/rules/#enum_value_prefix"><code class="language-plaintext highlighter-rouge"><span class="censored">ENUM_VALUE_PREFIX</span></code></a><span class="censored">.</span> <span class="censored">Even</span> <span class="censored">though</span> <span class="censored">you</span> <span class="censored">might</span> <span class="censored">think</span> <span class="censored">that</span> <span class="censored">an</span> <span class="censored">enum</span> <span class="censored">name</span> <span class="censored">will</span> <span class="censored">be</span> <span class="censored">unique,</span> <span class="censored">because</span> <span class="censored">top-level</span> <span class="censored">enums</span> <span class="censored">bleed</span> <span class="censored">their</span> <span class="censored">names</span> <span class="censored">into</span> <span class="censored">the</span> <span class="censored">containing</span> <span class="censored">package,</span> <span class="censored">the</span> <span class="censored">problem</span> <span class="censored">spreads</span> <span class="censored">across</span> <span class="censored">packages!</span></p> <h2 id="zero-values"><a href="#zero-values"><span class="censored">Zero</span> <span class="censored">Values</span></a></h2> <p><code class="language-plaintext highlighter-rouge"><span class="censored">proto3</span></code> <span class="censored">relies</span> <span class="censored">heavily</span> <span class="censored">on</span> <span class="censored">the</span> <span class="censored">concept</span> <span class="censored">of</span> <span class="censored">“zero</span> <span class="censored">values”</span> <span class="censored">–</span> <span class="censored">all</span> <span class="censored">non-message</span> <span class="censored">fields</span> <span class="censored">that</span> <span class="censored">are</span> <span class="censored">neither</span> <code class="language-plaintext highlighter-rouge"><span class="censored">repeated</span></code> <span class="censored">nor</span> <code class="language-plaintext highlighter-rouge"><span class="censored">optional</span></code> <span class="censored">are</span> <span class="censored">implicitly</span> <span class="censored">zero</span> <span class="censored">if</span> <span class="censored">they</span> <span class="censored">are</span> <span class="censored">not</span> <span class="censored">present.</span> <span class="censored">Thus,</span> <code class="language-plaintext highlighter-rouge"><span class="censored">proto3</span></code> <span class="censored">requires</span> <span class="censored">that</span> <span class="censored">enums</span> <span class="censored">specify</span> <span class="censored">a</span> <span class="censored">value</span> <span class="censored">equal</span> <span class="censored">to</span> <span class="censored">zero.</span></p> <p><span class="censored">By</span> <span class="censored">convention,</span> <span class="censored">this</span> <span class="censored">value</span> <span class="censored">shouldn’t</span> <span class="censored">be</span> <span class="censored">a</span> <span class="censored">specific</span> <span class="censored">value</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">enum,</span> <span class="censored">but</span> <span class="censored">rather</span> <span class="censored">a</span> <span class="censored">value</span> <span class="censored">representing</span> <span class="censored">that</span> <span class="censored">no</span> <span class="censored">value</span> <span class="censored">is</span> <span class="censored">specified.</span> <a href="https://buf.build/docs/lint/rules/#enum_zero_value_suffix"><code class="language-plaintext highlighter-rouge"><span class="censored">ENUM_ZERO_VALUE_SUFFIX</span></code></a> <span class="censored">enforces</span> <span class="censored">this,</span> <span class="censored">with</span> <span class="censored">a</span> <span class="censored">default</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">_UNSPECIFIED</span></code><span class="censored">.</span> <span class="censored">Of</span> <span class="censored">course,</span> <span class="censored">there</span> <span class="censored">are</span> <span class="censored">situations</span> <span class="censored">where</span> <span class="censored">this</span> <span class="censored">might</span> <span class="censored">not</span> <span class="censored">make</span> <span class="censored">sense</span> <span class="censored">for</span> <span class="censored">you,</span> <span class="censored">and</span> <span class="censored">a</span> <span class="censored">suffix</span> <span class="censored">like</span> <code class="language-plaintext highlighter-rouge"><span class="censored">_ZERO</span></code> <span class="censored">or</span> <code class="language-plaintext highlighter-rouge"><span class="censored">_UNKNOWN</span></code> <span class="censored">might</span> <span class="censored">make</span> <span class="censored">more</span> <span class="censored">sense.</span></p> <p><span class="censored">It</span> <span class="censored">may</span> <span class="censored">be</span> <span class="censored">tempting</span> <span class="censored">to</span> <span class="censored">have</span> <span class="censored">a</span> <span class="censored">specific</span> <span class="censored">“good</span> <span class="censored">default”</span> <span class="censored">value</span> <span class="censored">for</span> <span class="censored">the</span> <span class="censored">zero</span> <span class="censored">value.</span> <span class="censored">Beware</span> <span class="censored">though,</span> <span class="censored">because</span> <span class="censored">that</span> <span class="censored">choice</span> <span class="censored">is</span> <span class="censored">forever.</span> <span class="censored">Picking</span> <span class="censored">a</span> <span class="censored">generic</span> <span class="censored">“unknown”</span> <span class="censored">as</span> <span class="censored">the</span> <span class="censored">default</span> <span class="censored">reduces</span> <span class="censored">the</span> <span class="censored">chance</span> <span class="censored">you’ll</span> <span class="censored">burn</span> <span class="censored">yourself.</span></p> <h2 id="why-dont-all-of-googles-protobuf-files-do-this"><a href="#why-dont-all-of-googles-protobuf-files-do-this"><span class="censored">Why</span> <span class="censored">Don’t</span> <span class="censored">All</span> <span class="censored">of</span> <span class="censored">Google’s</span> <span class="censored">Protobuf</span> <span class="censored">Files</span> <span class="censored">Do</span> <span class="censored">This?</span></a></h2> <p><span class="censored">Name</span> <span class="censored">prefixes</span> <span class="censored">and</span> <span class="censored">zero</span> <span class="censored">values</span> <span class="censored">also</span> <span class="censored">teach</span> <span class="censored">us</span> <span class="censored">an</span> <span class="censored">important</span> <span class="censored">lesson:</span> <span class="censored">because</span> <span class="censored">Protobuf</span> <span class="censored">names</span> <span class="censored">are</span> <span class="censored">forever,</span> <span class="censored">it’s</span> <span class="censored">really</span> <span class="censored">hard</span> <span class="censored">to</span> <span class="censored">fix</span> <span class="censored">style</span> <span class="censored">mistakes,</span> <span class="censored">especially</span> <span class="censored">as</span> <span class="censored">we</span> <span class="censored">collectively</span> <span class="censored">get</span> <span class="censored">better</span> <span class="censored">at</span> <span class="censored">using</span> <span class="censored">Protobuf.</span></p> <p><code class="language-plaintext highlighter-rouge"><span class="censored">google.rpc.Code</span></code> <span class="censored">is</span> <span class="censored">intended</span> <span class="censored">to</span> <span class="censored">be</span> <span class="censored">source-compatible</span> <span class="censored">with</span> <span class="censored">very</span> <span class="censored">old</span> <span class="censored">existing</span> <span class="censored">C++</span> <span class="censored">code,</span> <span class="censored">so</span> <span class="censored">it</span> <span class="censored">throws</span> <span class="censored">caution</span> <span class="censored">to</span> <span class="censored">the</span> <span class="censored">wind.</span> <code class="language-plaintext highlighter-rouge"><span class="censored">FieldDescriptorProto.Type</span></code> <span class="censored">doesn’t</span> <span class="censored">have</span> <span class="censored">a</span> <span class="censored">zero</span> <span class="censored">value</span> <span class="censored">because</span> <span class="censored">in</span> <code class="language-plaintext highlighter-rouge"><span class="censored">proto2</span></code> <span class="censored">,</span> <span class="censored">which</span> <span class="censored">doesn’t</span> <span class="censored">have</span> <span class="censored">zero</span> <span class="censored">value</span> <span class="censored">footguns</span> <span class="censored">in</span> <span class="censored">its</span> <span class="censored">wire</span> <span class="censored">format,</span> <span class="censored">you</span> <span class="censored">don’t</span> <span class="censored">need</span> <span class="censored">to</span> <span class="censored">worry</span> <span class="censored">about</span> <span class="censored">that.</span> <span class="censored">The</span> <span class="censored">lesson</span> <span class="censored">isn’t</span> <span class="censored">just</span> <span class="censored">to</span> <span class="censored">use</span> <span class="censored">Buf’s</span> <span class="censored">linter</span> <span class="censored">to</span> <span class="censored">try</span> <span class="censored">to</span> <span class="censored">avoid</span> <span class="censored">some</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">known</span> <span class="censored">pitfalls,</span> <span class="censored">but</span> <span class="censored">also</span> <span class="censored">to</span> <span class="censored">remember</span> <span class="censored">that</span> <span class="censored">even</span> <span class="censored">APIs</span> <span class="censored">designed</span> <span class="censored">by</span> <span class="censored">the</span> <span class="censored">authors</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">language</span> <span class="censored">make</span> <span class="censored">unfixable</span> <span class="censored">mistakes,</span> <span class="censored">so</span> <span class="censored">unlike</span> <span class="censored">other</span> <span class="censored">programming</span> <span class="censored">languages,</span> <span class="censored">imitating</span> <span class="censored">“existing</span> <span class="censored">practice”</span> <span class="censored">isn’t</span> <span class="censored">always</span> <span class="censored">the</span> <span class="censored">best</span> <span class="censored">strategy.</span></p> </div> <div class="related post-footer"> <h2> <span class="censored">Related</span> <span class="censored">Posts</span> </h2> <ul class="related-posts"> <li> <span class="post-meta"><span class="censored">2025-06-03</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/06/03/protobuf-tip-7/"><span class="censored">Protobuf</span> <span class="censored">Tip</span> <span class="censored">#7:</span> <span class="censored">Scoping</span> <span class="censored">It</span> <span class="censored">Out</span></a></h6> </li> <li> <span class="post-meta"><span class="censored">2025-05-20</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/05/20/protobuf-tip-6/"><span class="censored">Protobuf</span> <span class="censored">Tip</span> <span class="censored">#6:</span> <span class="censored">The</span> <span class="censored">Subtle</span> <span class="censored">Dangers</span> <span class="censored">of</span> <span class="censored">Enum</span> <span class="censored">Aliases</span></a></h6> </li> <li> <span class="post-meta"><span class="censored">2025-05-13</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/05/13/protobuf-tip-5/"><span class="censored">Protobuf</span> <span class="censored">Tip</span> <span class="censored">#5:</span> <span class="censored">Avoid</span> <span class="censored">import</span> <span class="censored">public/weak</span></a></h6> </li> </ul> </div> </div> </div> </div></div> <div class="sidebar show-if-mobile footer"> <div class="container sidebar-sticky"> <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC BY-SA</a> • <a href="https://varz.mcyoung.xyz/">Site Analytics</a> <br> &copy; 2025 Miguel Young de la Sota </div> </div> </body> </html>