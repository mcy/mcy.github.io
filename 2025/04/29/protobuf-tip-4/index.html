<!DOCTYPE html> <html lang="en-us"> <head> <link href="https://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Protobuf Tip #4: Accepting Mistakes We Can't Fix &middot; mcyoung </title> <script async src="https://mcyoung.xyz/public/js/redirect.js"></script> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/syntax.css"> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/syntax-overrides.css"> <link rel="stylesheet" href="https://mcyoung.xyz/public/css/style.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"> <link rel="preload" href="https://mcyoung.xyz/public/fonts/abril-fatface.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/rokkitt.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/rokkitt-italic.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/spline-mono.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://mcyoung.xyz/public/fonts/spline-mono-italic.woff2" as="font" type="font/woff2" crossorigin> <link rel="shortcut icon" href="https://mcyoung.xyz/public/favicon.ico"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <script src="https://mcyoung.xyz/public/js/minimap.js"></script> <script data-goatcounter="https://mcy.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:title" content="Protobuf Tip #4: Accepting Mistakes We Can't Fix &middot; mcyoung"> <meta name="twitter:image" content="https://mcyoung.xyz/og/protobuf-tip-4-cbb0a6b15d372838b779b212a85253fa12f7d3ed.png"> <meta property="og:title" content="Protobuf Tip #4: Accepting Mistakes We Can't Fix &middot; mcyoung"> <meta property="og:type" content="object"> <meta property="og:image" content="https://mcyoung.xyz/og/protobuf-tip-4-cbb0a6b15d372838b779b212a85253fa12f7d3ed.png"> <meta property="og:height" content="630"> <meta property="og:width" content="1200"> <meta property="og:url" content="https://mcyoung.xyz/2025/04/29/protobuf-tip-4/"> <link rel="canonical" href="https://buf.build/blog/totw-4-accepting-mistakes"> </head> <body> <div class="sidebar"> <div class="sidebar-avatar hide-if-mobile"> <a href="https://mcyoung.xyz"> <img class="sidebar-avatar" src="https://mcyoung.xyz/public/images/avatar.png" alt="Yeah, I drew this. Check out my art blog."></a> </div> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1><a href="https://mcyoung.xyz"> mcyoung </a></h1> <div class="lead hide-if-mobile">I'm Miguel. I write about compilers, performance, and silly computer things. I also draw Pokémon. </div> </div> <hr class="hide-if-mobile"/> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="https://mcyoung.xyz">Home</a> • <a class="sidebar-nav-item " href="https://art.mcyoung.xyz">Art</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/resume">Resumé</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/syllabus">Syllabus</a> </nav> <nav class="sidebar-nav"> <a class="sidebar-nav-item" href="https://mcyoung.xyz/about">About</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/posts">Posts</a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/tags">Tags</a> • <a class="sidebar-nav-item" href="https://github.com/mcy"> <img src="https://mcyoung.xyz/public/images/github.svg"></a> • <a class="sidebar-nav-item" href="https://bsky.app/profile/mcy.gay"> <img style="height: 0.75em;" src="https://mcyoung.xyz/public/images/bsky.svg"></a> • <a class="sidebar-nav-item" href="https://mcyoung.xyz/feed"> <img style="height: 0.8em; transform: translate(0.07em, 0.15em);" src="https://mcyoung.xyz/public/images/rss.svg"></a> </nav> <br class="hide-if-mobile"/> <span class="hide-if-mobile"> <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC BY-SA</a> • <a href="https://varz.mcyoung.xyz/">Site Analytics</a> <br> &copy; 2025 Miguel Young de la Sota</span> </div> </div> <div class="content container"><div class="post-title"> <span class="post-meta"> 2025-04-29 • 836 words • 9 minutes <br class="show-if-mobile"/> <span class="hide-if-mobile">•</span> <a href="https://mcyoung.xyz/tags.html#protobuf-tips">#protobuf-tips</a> </span> <h1><a href="/2025/04/29/protobuf-tip-4/"> Protobuf Tip #4: Accepting Mistakes We Can't Fix </a></h1> </div> <div class="post"> <p><em>Bad humor is an evasion of reality; good humor is an acceptance of it. –Malcolm Muggeridge</em></p> <p>TL;DR: Protobuf’s distributed nature introduces evolution risks that make it hard to fix some types of mistakes. Sometimes the best thing to do is to just let it be.</p> <blockquote> <p>I’m editing a series of best practice pieces on Protobuf, a language that I work on which has lots of evil corner-cases.These are shorter than what I typically post here, but I think it fits with what you, dear reader, come to this blog for. These tips are also posted on the <a href="https://buf.build/blog/totw-4-accepting-mistakes">buf.build blog</a>.</p> </blockquote> <h2 id="a-different-mindset"><a href="#a-different-mindset">A Different Mindset</a></h2> <p>Often, you’ll design and implement a feature for the software you work on, and despite your best efforts to test it, something terrible happens in production. We have a playbook for this, though: fix the bug in your program and ship or deploy the new, fixed version to your users. It might mean working late for big emergencies, but turnaround for most organizations is a day to a week.</p> <p>Most bugs aren’t emergencies, though. Sometimes a function has a confusing name, or an integer type is just a bit too small for real-world data, or an API conflates “zero” and “null”. You fix the API, refactor all usages in your API in one commit, merge, and the fix rolls out gradually.</p> <p>Unless, of course, it’s a bug in a communication API, like a serialization format: your Protobuf types, or your JSON schema, or the not-too-pretty code that parses fields out of dict built from a YAML file. Here, you can’t <em>just</em> atomically fix the world. Fixing bugs in your APIs (from here on, “APIs” means “Protobuf definitions”) requires a different mindset than fixing bugs in ordinary code.</p> <h2 id="what-are-the-risks"><a href="#what-are-the-risks">What Are the Risks?</a></h2> <p>Protobuf’s wire format is designed so that you can safely add new fields to a type, or values to an enum, without needing to perform an atomic upgrade. But other changes, like renaming fields or changing their type, are very dangerous.</p> <p>This is because Protobuf types exist on a temporal axis: different versions of the same type exist simultaneously among programs in the field that are actively talking to each other. This means that <em>writers from the future</em> (that is, new serialization code) must be careful to not confuse the many <em>readers from the past</em> (old versions of the deserialization code). Conversely, future readers must tolerate anything past writers produce.</p> <p>In a modern distributed deployment, the number of versions that exist at once can be quite large. This is true even in self-hosted clusters, but becomes much more fraught whenever user-upgradable software is involved. This can include mobile applications that talk to your servers, or appliance software managed by a third-party administrator, or even just browser-service communication.</p> <p>The most important principle: you can’t easily control when old versions of a type or service are no longer relevant. As soon as a type escapes out of the scope of even a single team, upgrading types becomes a departmental effort.</p> <h2 id="learning-to-love-the-bomb"><a href="#learning-to-love-the-bomb">Learning to Love the Bomb</a></h2> <p>There are many places where Protobuf could have made schema evolution easier, but didn’t. For example, changing <code class="language-plaintext highlighter-rouge">int32 foo = 1;</code> to <code class="language-plaintext highlighter-rouge">sfixed32 foo = 1;</code> is a breakage, even though at the wire format level, it is <em>possible</em> for a parser to distinguish and accept both forms of <code class="language-plaintext highlighter-rouge">foo</code> correctly. There too many other examples to list, but it’s important to understand that the language is not always working in our favor.</p> <p>For example, if we notice a <code class="language-plaintext highlighter-rouge">int32</code> value is too small, and should have been 64-bit, you can’t upgrade it without readers from the past potentially truncating it. But we really have to upgrade it! What are our options?</p> <ol> <li>Issue a new version of the message and all of its dependencies. This is the main reason why sticking a version number in the package name, as enforced by Buf’s <a href="https://buf.build/docs/lint/rules/#package_version_suffix"><code class="language-plaintext highlighter-rouge">PACKAGE_VERSION_SUFFIX</code></a> lint rule, is so important.</li> <li>Do the upgrade anyway and hope nothing breaks. This <em>can</em> work for certain kinds of upgrades, if the underlying format is compatible, but it can have <strong>disastrous consequences</strong> if you don’t know what you’re doing, especially if it’s a type that’s not completely internal to a team’s project. <a href="https://buf.build/docs/breaking/overview/">Buf breaking change detection</a> helps you avoid changes with potential for breakage.</li> </ol> <p>Of course, there is a third option, which is to accept that some things aren’t worth fixing. When the cost of a fix is so high, fixes just aren’t worth it, especially when the language is working against us.</p> <p>This means that even in Buf’s own APIs, we sometimes do things in a way that isn’t quite ideal, or is inconsistent with our own best practices. Sometimes, the ecosystem changes in a way that changes best practice, but we can’t upgrade to it without breaking our users. In the same way, you shouldn’t rush to use new, better language features if they would cause protocol breaks: sometimes, the right thing is to do nothing, because not breaking your users is more important. <br/></p> <p> </p> </div> <div class="related post-footer"> <h2>Related Posts</h2> <ul class="related-posts"> <li> <span class="post-meta">2025-07-16</span> / <h6 style="display:inline"><a href="/2025/07/16/hyperpb/">Parsing Protobuf Like Never Before</a></h6> <li> <span class="post-meta">2025-07-14</span> / <h6 style="display:inline"><a href="/2025/07/14/best/">The Best C++ Library</a></h6> <li> <span class="post-meta">2025-07-07</span> / <h6 style="display:inline"><a href="/2025/07/07/nosplit/">What's //go:nosplit for?</a></h6> </ul> </div> <div class="minimap" aria-hidden="true"> <div class="minimap-size"></div> <div class="minimap-controller"></div> <div class="minimap-content"> <div class="content container"> <div class="post-title"> <span class="post-meta"> <span class="censored">2025-04-29</span> <span class="censored">•</span> <span class="censored">836</span> <span class="censored">words</span> <span class="censored">•</span> <span class="censored">9</span> <span class="censored">minutes</span> <br class="show-if-mobile"> <span class="hide-if-mobile"><span class="censored">•</span></span> <a href="https://mcyoung.xyz/tags.html#protobuf-tips"><span class="censored">#protobuf-tips</span></a> </span> <h1><a href="/2025/04/29/protobuf-tip-4/"> <span class="censored">Protobuf</span> <span class="censored">Tip</span> <span class="censored">#4:</span> <span class="censored">Accepting</span> <span class="censored">Mistakes</span> <span class="censored">We</span> <span class="censored">Can't</span> <span class="censored">Fix</span> </a></h1> </div> <div class="post"> <p><em><span class="censored">Bad</span> <span class="censored">humor</span> <span class="censored">is</span> <span class="censored">an</span> <span class="censored">evasion</span> <span class="censored">of</span> <span class="censored">reality;</span> <span class="censored">good</span> <span class="censored">humor</span> <span class="censored">is</span> <span class="censored">an</span> <span class="censored">acceptance</span> <span class="censored">of</span> <span class="censored">it.</span> <span class="censored">–Malcolm</span> <span class="censored">Muggeridge</span></em></p> <p><span class="censored">TL;DR:</span> <span class="censored">Protobuf’s</span> <span class="censored">distributed</span> <span class="censored">nature</span> <span class="censored">introduces</span> <span class="censored">evolution</span> <span class="censored">risks</span> <span class="censored">that</span> <span class="censored">make</span> <span class="censored">it</span> <span class="censored">hard</span> <span class="censored">to</span> <span class="censored">fix</span> <span class="censored">some</span> <span class="censored">types</span> <span class="censored">of</span> <span class="censored">mistakes.</span> <span class="censored">Sometimes</span> <span class="censored">the</span> <span class="censored">best</span> <span class="censored">thing</span> <span class="censored">to</span> <span class="censored">do</span> <span class="censored">is</span> <span class="censored">to</span> <span class="censored">just</span> <span class="censored">let</span> <span class="censored">it</span> <span class="censored">be.</span></p> <blockquote> <p><span class="censored">I’m</span> <span class="censored">editing</span> <span class="censored">a</span> <span class="censored">series</span> <span class="censored">of</span> <span class="censored">best</span> <span class="censored">practice</span> <span class="censored">pieces</span> <span class="censored">on</span> <span class="censored">Protobuf,</span> <span class="censored">a</span> <span class="censored">language</span> <span class="censored">that</span> <span class="censored">I</span> <span class="censored">work</span> <span class="censored">on</span> <span class="censored">which</span> <span class="censored">has</span> <span class="censored">lots</span> <span class="censored">of</span> <span class="censored">evil</span> <span class="censored">corner-cases.These</span> <span class="censored">are</span> <span class="censored">shorter</span> <span class="censored">than</span> <span class="censored">what</span> <span class="censored">I</span> <span class="censored">typically</span> <span class="censored">post</span> <span class="censored">here,</span> <span class="censored">but</span> <span class="censored">I</span> <span class="censored">think</span> <span class="censored">it</span> <span class="censored">fits</span> <span class="censored">with</span> <span class="censored">what</span> <span class="censored">you,</span> <span class="censored">dear</span> <span class="censored">reader,</span> <span class="censored">come</span> <span class="censored">to</span> <span class="censored">this</span> <span class="censored">blog</span> <span class="censored">for.</span> <span class="censored">These</span> <span class="censored">tips</span> <span class="censored">are</span> <span class="censored">also</span> <span class="censored">posted</span> <span class="censored">on</span> <span class="censored">the</span> <a href="https://buf.build/blog/totw-4-accepting-mistakes"><span class="censored">buf.build</span> <span class="censored">blog</span></a><span class="censored">.</span></p> </blockquote> <h2 id="a-different-mindset"><a href="#a-different-mindset"><span class="censored">A</span> <span class="censored">Different</span> <span class="censored">Mindset</span></a></h2> <p><span class="censored">Often,</span> <span class="censored">you’ll</span> <span class="censored">design</span> <span class="censored">and</span> <span class="censored">implement</span> <span class="censored">a</span> <span class="censored">feature</span> <span class="censored">for</span> <span class="censored">the</span> <span class="censored">software</span> <span class="censored">you</span> <span class="censored">work</span> <span class="censored">on,</span> <span class="censored">and</span> <span class="censored">despite</span> <span class="censored">your</span> <span class="censored">best</span> <span class="censored">efforts</span> <span class="censored">to</span> <span class="censored">test</span> <span class="censored">it,</span> <span class="censored">something</span> <span class="censored">terrible</span> <span class="censored">happens</span> <span class="censored">in</span> <span class="censored">production.</span> <span class="censored">We</span> <span class="censored">have</span> <span class="censored">a</span> <span class="censored">playbook</span> <span class="censored">for</span> <span class="censored">this,</span> <span class="censored">though:</span> <span class="censored">fix</span> <span class="censored">the</span> <span class="censored">bug</span> <span class="censored">in</span> <span class="censored">your</span> <span class="censored">program</span> <span class="censored">and</span> <span class="censored">ship</span> <span class="censored">or</span> <span class="censored">deploy</span> <span class="censored">the</span> <span class="censored">new,</span> <span class="censored">fixed</span> <span class="censored">version</span> <span class="censored">to</span> <span class="censored">your</span> <span class="censored">users.</span> <span class="censored">It</span> <span class="censored">might</span> <span class="censored">mean</span> <span class="censored">working</span> <span class="censored">late</span> <span class="censored">for</span> <span class="censored">big</span> <span class="censored">emergencies,</span> <span class="censored">but</span> <span class="censored">turnaround</span> <span class="censored">for</span> <span class="censored">most</span> <span class="censored">organizations</span> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">day</span> <span class="censored">to</span> <span class="censored">a</span> <span class="censored">week.</span></p> <p><span class="censored">Most</span> <span class="censored">bugs</span> <span class="censored">aren’t</span> <span class="censored">emergencies,</span> <span class="censored">though.</span> <span class="censored">Sometimes</span> <span class="censored">a</span> <span class="censored">function</span> <span class="censored">has</span> <span class="censored">a</span> <span class="censored">confusing</span> <span class="censored">name,</span> <span class="censored">or</span> <span class="censored">an</span> <span class="censored">integer</span> <span class="censored">type</span> <span class="censored">is</span> <span class="censored">just</span> <span class="censored">a</span> <span class="censored">bit</span> <span class="censored">too</span> <span class="censored">small</span> <span class="censored">for</span> <span class="censored">real-world</span> <span class="censored">data,</span> <span class="censored">or</span> <span class="censored">an</span> <span class="censored">API</span> <span class="censored">conflates</span> <span class="censored">“zero”</span> <span class="censored">and</span> <span class="censored">“null”.</span> <span class="censored">You</span> <span class="censored">fix</span> <span class="censored">the</span> <span class="censored">API,</span> <span class="censored">refactor</span> <span class="censored">all</span> <span class="censored">usages</span> <span class="censored">in</span> <span class="censored">your</span> <span class="censored">API</span> <span class="censored">in</span> <span class="censored">one</span> <span class="censored">commit,</span> <span class="censored">merge,</span> <span class="censored">and</span> <span class="censored">the</span> <span class="censored">fix</span> <span class="censored">rolls</span> <span class="censored">out</span> <span class="censored">gradually.</span></p> <p><span class="censored">Unless,</span> <span class="censored">of</span> <span class="censored">course,</span> <span class="censored">it’s</span> <span class="censored">a</span> <span class="censored">bug</span> <span class="censored">in</span> <span class="censored">a</span> <span class="censored">communication</span> <span class="censored">API,</span> <span class="censored">like</span> <span class="censored">a</span> <span class="censored">serialization</span> <span class="censored">format:</span> <span class="censored">your</span> <span class="censored">Protobuf</span> <span class="censored">types,</span> <span class="censored">or</span> <span class="censored">your</span> <span class="censored">JSON</span> <span class="censored">schema,</span> <span class="censored">or</span> <span class="censored">the</span> <span class="censored">not-too-pretty</span> <span class="censored">code</span> <span class="censored">that</span> <span class="censored">parses</span> <span class="censored">fields</span> <span class="censored">out</span> <span class="censored">of</span> <span class="censored">dict</span> <span class="censored">built</span> <span class="censored">from</span> <span class="censored">a</span> <span class="censored">YAML</span> <span class="censored">file.</span> <span class="censored">Here,</span> <span class="censored">you</span> <span class="censored">can’t</span> <em><span class="censored">just</span></em> <span class="censored">atomically</span> <span class="censored">fix</span> <span class="censored">the</span> <span class="censored">world.</span> <span class="censored">Fixing</span> <span class="censored">bugs</span> <span class="censored">in</span> <span class="censored">your</span> <span class="censored">APIs</span> <span class="censored">(from</span> <span class="censored">here</span> <span class="censored">on,</span> <span class="censored">“APIs”</span> <span class="censored">means</span> <span class="censored">“Protobuf</span> <span class="censored">definitions”)</span> <span class="censored">requires</span> <span class="censored">a</span> <span class="censored">different</span> <span class="censored">mindset</span> <span class="censored">than</span> <span class="censored">fixing</span> <span class="censored">bugs</span> <span class="censored">in</span> <span class="censored">ordinary</span> <span class="censored">code.</span></p> <h2 id="what-are-the-risks"><a href="#what-are-the-risks"><span class="censored">What</span> <span class="censored">Are</span> <span class="censored">the</span> <span class="censored">Risks?</span></a></h2> <p><span class="censored">Protobuf’s</span> <span class="censored">wire</span> <span class="censored">format</span> <span class="censored">is</span> <span class="censored">designed</span> <span class="censored">so</span> <span class="censored">that</span> <span class="censored">you</span> <span class="censored">can</span> <span class="censored">safely</span> <span class="censored">add</span> <span class="censored">new</span> <span class="censored">fields</span> <span class="censored">to</span> <span class="censored">a</span> <span class="censored">type,</span> <span class="censored">or</span> <span class="censored">values</span> <span class="censored">to</span> <span class="censored">an</span> <span class="censored">enum,</span> <span class="censored">without</span> <span class="censored">needing</span> <span class="censored">to</span> <span class="censored">perform</span> <span class="censored">an</span> <span class="censored">atomic</span> <span class="censored">upgrade.</span> <span class="censored">But</span> <span class="censored">other</span> <span class="censored">changes,</span> <span class="censored">like</span> <span class="censored">renaming</span> <span class="censored">fields</span> <span class="censored">or</span> <span class="censored">changing</span> <span class="censored">their</span> <span class="censored">type,</span> <span class="censored">are</span> <span class="censored">very</span> <span class="censored">dangerous.</span></p> <p><span class="censored">This</span> <span class="censored">is</span> <span class="censored">because</span> <span class="censored">Protobuf</span> <span class="censored">types</span> <span class="censored">exist</span> <span class="censored">on</span> <span class="censored">a</span> <span class="censored">temporal</span> <span class="censored">axis:</span> <span class="censored">different</span> <span class="censored">versions</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">same</span> <span class="censored">type</span> <span class="censored">exist</span> <span class="censored">simultaneously</span> <span class="censored">among</span> <span class="censored">programs</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">field</span> <span class="censored">that</span> <span class="censored">are</span> <span class="censored">actively</span> <span class="censored">talking</span> <span class="censored">to</span> <span class="censored">each</span> <span class="censored">other.</span> <span class="censored">This</span> <span class="censored">means</span> <span class="censored">that</span> <em><span class="censored">writers</span> <span class="censored">from</span> <span class="censored">the</span> <span class="censored">future</span></em> <span class="censored">(that</span> <span class="censored">is,</span> <span class="censored">new</span> <span class="censored">serialization</span> <span class="censored">code)</span> <span class="censored">must</span> <span class="censored">be</span> <span class="censored">careful</span> <span class="censored">to</span> <span class="censored">not</span> <span class="censored">confuse</span> <span class="censored">the</span> <span class="censored">many</span> <em><span class="censored">readers</span> <span class="censored">from</span> <span class="censored">the</span> <span class="censored">past</span></em> <span class="censored">(old</span> <span class="censored">versions</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">deserialization</span> <span class="censored">code).</span> <span class="censored">Conversely,</span> <span class="censored">future</span> <span class="censored">readers</span> <span class="censored">must</span> <span class="censored">tolerate</span> <span class="censored">anything</span> <span class="censored">past</span> <span class="censored">writers</span> <span class="censored">produce.</span></p> <p><span class="censored">In</span> <span class="censored">a</span> <span class="censored">modern</span> <span class="censored">distributed</span> <span class="censored">deployment,</span> <span class="censored">the</span> <span class="censored">number</span> <span class="censored">of</span> <span class="censored">versions</span> <span class="censored">that</span> <span class="censored">exist</span> <span class="censored">at</span> <span class="censored">once</span> <span class="censored">can</span> <span class="censored">be</span> <span class="censored">quite</span> <span class="censored">large.</span> <span class="censored">This</span> <span class="censored">is</span> <span class="censored">true</span> <span class="censored">even</span> <span class="censored">in</span> <span class="censored">self-hosted</span> <span class="censored">clusters,</span> <span class="censored">but</span> <span class="censored">becomes</span> <span class="censored">much</span> <span class="censored">more</span> <span class="censored">fraught</span> <span class="censored">whenever</span> <span class="censored">user-upgradable</span> <span class="censored">software</span> <span class="censored">is</span> <span class="censored">involved.</span> <span class="censored">This</span> <span class="censored">can</span> <span class="censored">include</span> <span class="censored">mobile</span> <span class="censored">applications</span> <span class="censored">that</span> <span class="censored">talk</span> <span class="censored">to</span> <span class="censored">your</span> <span class="censored">servers,</span> <span class="censored">or</span> <span class="censored">appliance</span> <span class="censored">software</span> <span class="censored">managed</span> <span class="censored">by</span> <span class="censored">a</span> <span class="censored">third-party</span> <span class="censored">administrator,</span> <span class="censored">or</span> <span class="censored">even</span> <span class="censored">just</span> <span class="censored">browser-service</span> <span class="censored">communication.</span></p> <p><span class="censored">The</span> <span class="censored">most</span> <span class="censored">important</span> <span class="censored">principle:</span> <span class="censored">you</span> <span class="censored">can’t</span> <span class="censored">easily</span> <span class="censored">control</span> <span class="censored">when</span> <span class="censored">old</span> <span class="censored">versions</span> <span class="censored">of</span> <span class="censored">a</span> <span class="censored">type</span> <span class="censored">or</span> <span class="censored">service</span> <span class="censored">are</span> <span class="censored">no</span> <span class="censored">longer</span> <span class="censored">relevant.</span> <span class="censored">As</span> <span class="censored">soon</span> <span class="censored">as</span> <span class="censored">a</span> <span class="censored">type</span> <span class="censored">escapes</span> <span class="censored">out</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">scope</span> <span class="censored">of</span> <span class="censored">even</span> <span class="censored">a</span> <span class="censored">single</span> <span class="censored">team,</span> <span class="censored">upgrading</span> <span class="censored">types</span> <span class="censored">becomes</span> <span class="censored">a</span> <span class="censored">departmental</span> <span class="censored">effort.</span></p> <h2 id="learning-to-love-the-bomb"><a href="#learning-to-love-the-bomb"><span class="censored">Learning</span> <span class="censored">to</span> <span class="censored">Love</span> <span class="censored">the</span> <span class="censored">Bomb</span></a></h2> <p><span class="censored">There</span> <span class="censored">are</span> <span class="censored">many</span> <span class="censored">places</span> <span class="censored">where</span> <span class="censored">Protobuf</span> <span class="censored">could</span> <span class="censored">have</span> <span class="censored">made</span> <span class="censored">schema</span> <span class="censored">evolution</span> <span class="censored">easier,</span> <span class="censored">but</span> <span class="censored">didn’t.</span> <span class="censored">For</span> <span class="censored">example,</span> <span class="censored">changing</span> <code class="language-plaintext highlighter-rouge"><span class="censored">int32</span> <span class="censored">foo</span> <span class="censored">=</span> <span class="censored">1;</span></code> <span class="censored">to</span> <code class="language-plaintext highlighter-rouge"><span class="censored">sfixed32</span> <span class="censored">foo</span> <span class="censored">=</span> <span class="censored">1;</span></code> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">breakage,</span> <span class="censored">even</span> <span class="censored">though</span> <span class="censored">at</span> <span class="censored">the</span> <span class="censored">wire</span> <span class="censored">format</span> <span class="censored">level,</span> <span class="censored">it</span> <span class="censored">is</span> <em><span class="censored">possible</span></em> <span class="censored">for</span> <span class="censored">a</span> <span class="censored">parser</span> <span class="censored">to</span> <span class="censored">distinguish</span> <span class="censored">and</span> <span class="censored">accept</span> <span class="censored">both</span> <span class="censored">forms</span> <span class="censored">of</span> <code class="language-plaintext highlighter-rouge"><span class="censored">foo</span></code> <span class="censored">correctly.</span> <span class="censored">There</span> <span class="censored">too</span> <span class="censored">many</span> <span class="censored">other</span> <span class="censored">examples</span> <span class="censored">to</span> <span class="censored">list,</span> <span class="censored">but</span> <span class="censored">it’s</span> <span class="censored">important</span> <span class="censored">to</span> <span class="censored">understand</span> <span class="censored">that</span> <span class="censored">the</span> <span class="censored">language</span> <span class="censored">is</span> <span class="censored">not</span> <span class="censored">always</span> <span class="censored">working</span> <span class="censored">in</span> <span class="censored">our</span> <span class="censored">favor.</span></p> <p><span class="censored">For</span> <span class="censored">example,</span> <span class="censored">if</span> <span class="censored">we</span> <span class="censored">notice</span> <span class="censored">a</span> <code class="language-plaintext highlighter-rouge"><span class="censored">int32</span></code> <span class="censored">value</span> <span class="censored">is</span> <span class="censored">too</span> <span class="censored">small,</span> <span class="censored">and</span> <span class="censored">should</span> <span class="censored">have</span> <span class="censored">been</span> <span class="censored">64-bit,</span> <span class="censored">you</span> <span class="censored">can’t</span> <span class="censored">upgrade</span> <span class="censored">it</span> <span class="censored">without</span> <span class="censored">readers</span> <span class="censored">from</span> <span class="censored">the</span> <span class="censored">past</span> <span class="censored">potentially</span> <span class="censored">truncating</span> <span class="censored">it.</span> <span class="censored">But</span> <span class="censored">we</span> <span class="censored">really</span> <span class="censored">have</span> <span class="censored">to</span> <span class="censored">upgrade</span> <span class="censored">it!</span> <span class="censored">What</span> <span class="censored">are</span> <span class="censored">our</span> <span class="censored">options?</span></p> <ol> <li> <span class="censored">Issue</span> <span class="censored">a</span> <span class="censored">new</span> <span class="censored">version</span> <span class="censored">of</span> <span class="censored">the</span> <span class="censored">message</span> <span class="censored">and</span> <span class="censored">all</span> <span class="censored">of</span> <span class="censored">its</span> <span class="censored">dependencies.</span> <span class="censored">This</span> <span class="censored">is</span> <span class="censored">the</span> <span class="censored">main</span> <span class="censored">reason</span> <span class="censored">why</span> <span class="censored">sticking</span> <span class="censored">a</span> <span class="censored">version</span> <span class="censored">number</span> <span class="censored">in</span> <span class="censored">the</span> <span class="censored">package</span> <span class="censored">name,</span> <span class="censored">as</span> <span class="censored">enforced</span> <span class="censored">by</span> <span class="censored">Buf’s</span> <a href="https://buf.build/docs/lint/rules/#package_version_suffix"><code class="language-plaintext highlighter-rouge"><span class="censored">PACKAGE_VERSION_SUFFIX</span></code></a> <span class="censored">lint</span> <span class="censored">rule,</span> <span class="censored">is</span> <span class="censored">so</span> <span class="censored">important.</span> </li> <li> <span class="censored">Do</span> <span class="censored">the</span> <span class="censored">upgrade</span> <span class="censored">anyway</span> <span class="censored">and</span> <span class="censored">hope</span> <span class="censored">nothing</span> <span class="censored">breaks.</span> <span class="censored">This</span> <em><span class="censored">can</span></em> <span class="censored">work</span> <span class="censored">for</span> <span class="censored">certain</span> <span class="censored">kinds</span> <span class="censored">of</span> <span class="censored">upgrades,</span> <span class="censored">if</span> <span class="censored">the</span> <span class="censored">underlying</span> <span class="censored">format</span> <span class="censored">is</span> <span class="censored">compatible,</span> <span class="censored">but</span> <span class="censored">it</span> <span class="censored">can</span> <span class="censored">have</span> <strong><span class="censored">disastrous</span> <span class="censored">consequences</span></strong> <span class="censored">if</span> <span class="censored">you</span> <span class="censored">don’t</span> <span class="censored">know</span> <span class="censored">what</span> <span class="censored">you’re</span> <span class="censored">doing,</span> <span class="censored">especially</span> <span class="censored">if</span> <span class="censored">it’s</span> <span class="censored">a</span> <span class="censored">type</span> <span class="censored">that’s</span> <span class="censored">not</span> <span class="censored">completely</span> <span class="censored">internal</span> <span class="censored">to</span> <span class="censored">a</span> <span class="censored">team’s</span> <span class="censored">project.</span> <a href="https://buf.build/docs/breaking/overview/"><span class="censored">Buf</span> <span class="censored">breaking</span> <span class="censored">change</span> <span class="censored">detection</span></a> <span class="censored">helps</span> <span class="censored">you</span> <span class="censored">avoid</span> <span class="censored">changes</span> <span class="censored">with</span> <span class="censored">potential</span> <span class="censored">for</span> <span class="censored">breakage.</span> </li> </ol> <p><span class="censored">Of</span> <span class="censored">course,</span> <span class="censored">there</span> <span class="censored">is</span> <span class="censored">a</span> <span class="censored">third</span> <span class="censored">option,</span> <span class="censored">which</span> <span class="censored">is</span> <span class="censored">to</span> <span class="censored">accept</span> <span class="censored">that</span> <span class="censored">some</span> <span class="censored">things</span> <span class="censored">aren’t</span> <span class="censored">worth</span> <span class="censored">fixing.</span> <span class="censored">When</span> <span class="censored">the</span> <span class="censored">cost</span> <span class="censored">of</span> <span class="censored">a</span> <span class="censored">fix</span> <span class="censored">is</span> <span class="censored">so</span> <span class="censored">high,</span> <span class="censored">fixes</span> <span class="censored">just</span> <span class="censored">aren’t</span> <span class="censored">worth</span> <span class="censored">it,</span> <span class="censored">especially</span> <span class="censored">when</span> <span class="censored">the</span> <span class="censored">language</span> <span class="censored">is</span> <span class="censored">working</span> <span class="censored">against</span> <span class="censored">us.</span></p> <p><span class="censored">This</span> <span class="censored">means</span> <span class="censored">that</span> <span class="censored">even</span> <span class="censored">in</span> <span class="censored">Buf’s</span> <span class="censored">own</span> <span class="censored">APIs,</span> <span class="censored">we</span> <span class="censored">sometimes</span> <span class="censored">do</span> <span class="censored">things</span> <span class="censored">in</span> <span class="censored">a</span> <span class="censored">way</span> <span class="censored">that</span> <span class="censored">isn’t</span> <span class="censored">quite</span> <span class="censored">ideal,</span> <span class="censored">or</span> <span class="censored">is</span> <span class="censored">inconsistent</span> <span class="censored">with</span> <span class="censored">our</span> <span class="censored">own</span> <span class="censored">best</span> <span class="censored">practices.</span> <span class="censored">Sometimes,</span> <span class="censored">the</span> <span class="censored">ecosystem</span> <span class="censored">changes</span> <span class="censored">in</span> <span class="censored">a</span> <span class="censored">way</span> <span class="censored">that</span> <span class="censored">changes</span> <span class="censored">best</span> <span class="censored">practice,</span> <span class="censored">but</span> <span class="censored">we</span> <span class="censored">can’t</span> <span class="censored">upgrade</span> <span class="censored">to</span> <span class="censored">it</span> <span class="censored">without</span> <span class="censored">breaking</span> <span class="censored">our</span> <span class="censored">users.</span> <span class="censored">In</span> <span class="censored">the</span> <span class="censored">same</span> <span class="censored">way,</span> <span class="censored">you</span> <span class="censored">shouldn’t</span> <span class="censored">rush</span> <span class="censored">to</span> <span class="censored">use</span> <span class="censored">new,</span> <span class="censored">better</span> <span class="censored">language</span> <span class="censored">features</span> <span class="censored">if</span> <span class="censored">they</span> <span class="censored">would</span> <span class="censored">cause</span> <span class="censored">protocol</span> <span class="censored">breaks:</span> <span class="censored">sometimes,</span> <span class="censored">the</span> <span class="censored">right</span> <span class="censored">thing</span> <span class="censored">is</span> <span class="censored">to</span> <span class="censored">do</span> <span class="censored">nothing,</span> <span class="censored">because</span> <span class="censored">not</span> <span class="censored">breaking</span> <span class="censored">your</span> <span class="censored">users</span> <span class="censored">is</span> <span class="censored">more</span> <span class="censored">important.</span> <br></p> <p> </p> </div> <div class="related post-footer"> <h2> <span class="censored">Related</span> <span class="censored">Posts</span> </h2> <ul class="related-posts"> <li> <span class="post-meta"><span class="censored">2025-07-16</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/07/16/hyperpb/"><span class="censored">Parsing</span> <span class="censored">Protobuf</span> <span class="censored">Like</span> <span class="censored">Never</span> <span class="censored">Before</span></a></h6> </li> <li> <span class="post-meta"><span class="censored">2025-07-14</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/07/14/best/"><span class="censored">The</span> <span class="censored">Best</span> <span class="censored">C++</span> <span class="censored">Library</span></a></h6> </li> <li> <span class="post-meta"><span class="censored">2025-07-07</span></span> <span class="censored">/</span> <h6 style="display:inline"><a href="/2025/07/07/nosplit/"><span class="censored">What's</span> <span class="censored">//go:nosplit</span> <span class="censored">for?</span></a></h6> </li> </ul> </div> </div> </div> </div></div> <div class="sidebar show-if-mobile footer"> <div class="container sidebar-sticky"> <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC BY-SA</a> • <a href="https://varz.mcyoung.xyz/">Site Analytics</a> <br> &copy; 2025 Miguel Young de la Sota </div> </div> </body> </html>